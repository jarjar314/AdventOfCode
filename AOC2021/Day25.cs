using System;
using System.Collections.Generic;
using System.Text;
using System.Linq;
using System.Text.RegularExpressions;
using System.Security.Cryptography;
using System.Diagnostics;

namespace AOC2021
{
    public class Day25
    {

        public static void Main()
        {
            var sw = Stopwatch.StartNew();
            var input = @"v...>>.vv>
.vv>>.vv..
>>.>v>...v
>>v>>.>.v.
v>v.vv.v..
>.>>..v...
.vv..>.>v.
v.v..>>v.v
....v..v.>";
            input = @"vv.v.v>.>.>.>vvvvv..v>v..>vv........>>>..v.v>>..vv>>>>vv>>>..>>..>>..v.v>....>.>..>..>>>..>>v.vv..>.vv>.v>vv>.>.v>v>vv>>v.>v..v..vvv.v>...v
..v..>.>>v.>..>v>>.......>v..>..v>>.vv.vv>>v.....>.>...>.v.>v.>>..v.>v.v.>>..v>>.>>v>>...v..>.v.v.v.>vv>>v.>.v.....v>.>.v.>....>....>..v...
>.>v...v>....>.>v...v.>....>vvv.vvv...>v....>v...>..>...>...>v....v>v.v>v>>..v.>...>>..v.v.vvv.>....>.>>.....>v>.>>..v.v..v....>vv>>.>v..>>
.vv>.vv..>..>vvv.vv..>........vvv>>vv.>>>.v.v.v.>v>..>..v......vv>...>..v.>v.v.>.v.v>>.>.>..vv...v..vvv.>vv>..v>v>v.>.>v>v>>..>.v...v.v>>.>
.>>.>v...v...>..>.v.vv.>v>.v...vv>.v..>>..v>.>v>vv.>..v>.v.>.v....>.vv.>..>.>.>.....v...>.>>.v>v>...vv.>>...>.v>v>v..>..>.v.>>......vv..vv.
v...v.>v>...v...>vv>v..>v...vvv....v>.v...>.>>.>.v.v..>.>>...vv..>...vv.v>v>.v..v...v....v..>.v>vv.>vvv..vv>v.>.v..v>..v..v.>>v>..>.....v.>
>....v>.v..vv....vv......v>>.v.v.>..>vv..vv.>.>v.>v>.>vvv.>..>>v.vvvv.>..>>....v>>.>v...>>>v.v..v...>>...>v>>.....>.vvvv>>.>v..v..>.vvv...>
..>..>>>.>.>.v....v.....v>>.>v>v...v.v..>v..v>...v.v..vv.vvvv...>>.>v>.>v...>v>.>..vvv...v>...>v>.>.>v.>...>.v.v.v.v.vvv>.v..>vv.v>..>>.>.v
>>.vv..>v.>.>...v.v..>v......vvv.vv>.vv....>..vv>.>..v>>.>vvv..>.>...>>v....v.>.v.vv>>.v..>>vv>......>....>v..>v>..>v.>>..v>>.v>.>....v..v.
.v.>..>.>v>.v>>.v.v..>..v..>...>v..>>vv.>.vv.>>>>v>.>>.v.v.>.....vv....v..>v.>vv>v>>..v.vvv.v.....>>......>.v....>v>..>>>>v>vv.vvv..v>.>>.v
.v.v>.v.....>>v..>.....>.......v...vvv.vv.>>v.vvv.....v....v.vv....v>......>v.v..>>v.>>.v.>>..>..v>.>.>.v>.v>.vv>.v...>.vv>v.....>..>>.....
>..>..>>.>.vvv.>.>.v.vv.>..v...>.>v.>.v...>>.....>v.>v..v>.v.v.......>v....v>vvv.v.v>v..v>>...v>>.v>v>vv..vvvv>..>..v>v..>.>...>..>v......v
.v..>v>v..vv.v..v..v..v.....>.>....>v>.....vv..v....vv.>vv..>.>..v.>..vv.>>...v...v.>>>.v..v..>...>.........vv>...>>>....>>.v>..v..>.>v.v.v
>>>..>.>>>v..>.>.vv.>.>>>>.>>.......v.v.>..v>v>..vvv..>.....>.>.>vv..>v..v..v...v>v.>>....v>..>.v..v...>v>>v>.vv.>>...>>v...vv.>.v>>>..>>.>
>....>.v>v>.>.v.>vv.>>....>...>.v.v>v>v.vv>v.>.>..>vv.>...v..>.vv..>...>vvv>vv..>....>....>.....v.>..>..>>v>.>...>...>>>>v.v>>v...>v>.v>.>.
>.v.>.vvv.vv.>.>..v......>>v>vv>......v..>......v.v>>...>..v>...v>..v...vvv.>.>....>.>>v..v>..>.vv.vv....>v>..v>...>..>>>.v>>>.v...>..>v...
.v.vvv>.v.v.>v>..v...v..>v>>v.....v......vv.>vvv...v>v.>>>v...>>.>v>........v>...vv>v...>..v..v>.>....v>.v.v.vv>.v>>v..>>>..v.v.>v>v...vv..
v>..>vv.>..v>v.vv......vv.vv>.>.....v.vvv.>>>>>>>v.>>>.>>.>.v...>v.v.>>v.>.v.......>.>..v>..>>>>.v.v..v....v.>>..>.v>.>v.>..v.v.>.>..v.>..v
..>v..>.>vvv>>v..v.v.......>.>.>>....>>.>...>..v..>>....>>v...>>...v..>.>.v>>.>>.>vv>v.v>.v.>..>vvv>........v.v>...vv.>v>..v>>.vvv>vv.>....
...>.vvv..>.v..>>.>.v>v.v..>v..vv....>>>>.>>>.v>..vv.>.v..vv>>>..>.>>.v.....v.vv>>.v.........>v.v.>.>>.>>..>>.>.v.>>.....vv...vv>.v..>.v...
>>...>..>..vv>..vv.....v.....>v.....>>..v>.v...>.>.........>>.>.>..>...v.vv>v...>.v.v..>..v.>.v>.v.>.v..vv.....v...>.>>v>...v.>..v...>v>v.>
.>v.v.........>.v>..v.v.vv.>>.>v>v.v>>v...v>.>vvv>>.v.v.v.>.>.v>v..>.......v>..v..>>v.v>...v>..v>...v>v>.vv>....v>.>.>>.v.>.>v..>v>.>vv....
>........v..>...v.>>v.v.>..v.>v>>...>>..>>>>>>v.>.v...v..>.vvv>>>v.>>vv.>.vvv..v>...>.v>v.>.>v..v>.>>...v>.>.>....v.vv....>v.v>>vv>.v>vv.>v
..v>..v.>v..vv.v>>.>.>...v>v.vv>>v.v..v>.>...v>>>.vv....v>.vv.>>>.>.>.v.v...v...>...v....>.v>>v>....v>>v..v.>v>>..v...v....v.>>..v....v....
>.v..v..v.v>..>>..v.v>v..v.v..>.v>...>>>v>.>>..>>...v..>..>.>>.......>....vv.v>>...v.>>>vvvv>>..vv..>>v>..>.vvv>..>>..vv>.v.>v.>..>vvv..>v>
.v>.>...>..>>>.>v>vvvv...vv>v>v...>>.>.....v.>vv>.v.>.vv.v.>...vv.>v>>>v>...v.v...>>>>..v.>..>v>....v>.>.>vv..v..>....>.v.vv.>..v.>..v.v.>>
v..v.>..vv..v..v.>..v>v..>.v>....vvv..>>>.>vv..vv..v.>...>>.....>v>.v>..>vvvv>.vv.>.......v..v.v.>.....>...v.>......>.....vv..>v>vv.v.....>
.v>>vvv>>.v.v.v.........>>..v>v.v..vv.>..>>.>..vvv>.>..v>.vvvv>.v>>.>...>vv..v......>.v>>v...>>.vv...v>...v......>.v.v.>...>.v.v.>..v>>>>vv
.v>.>v>....v.vvv>.v>>>.>v.>>>..>.>..v..>.v.v>.>..v..v>...v.v.v>.>v>.v>.v>v.vv...>..>..>...v.>v>...vv>>.....v.v>..v>.v>..>>.>vv..vv..>.v>>.>
v>v>>vv....>>.>.v....>..>v....vv..>vv..>>>v.v>.....>>...>v>v>vv>.>v......v.>.>vv>.>.>.>.>v>.v..>..>...>.v.v>..v>>v>..>v>..v.v.vvv>.>>.v..vv
.>>>>v...>..v..v>....v>..v....v.>>...>>..v..v..>vvv...>..vv>.>..>.v>vv>vv..>>.>>vv>.....>>v..>vvv.>..........v..>>.>...>>...v...>.v>..>v>v>
...v...v..>..v>.>..>.>....v.>>>.>v>..>.v..>v>>...vvv..>vvvv.>>..v..>>>>...vvv>>.>v>...v...>.>vv.v.>.>..>.v.>.>.v..>.>...>.>>.v>..vv.v..v>..
v...v>..>>>.>.>v>>.>.......v>.>.vv>>>v..v...v>.v..v...v.vv......>>.>v.>..v.v...>>.>>vvv.v.v...>.>..v>.......v>.>v.>.......>.>v>.v.v.>>>.v..
v..>.>..v..>vv>v..vv.>v..>v.>vv>...v........>v.>...>.>.v>.v.....>>>>....vv.>v>v.v..v....vv>.....>>..v>.>.v>v......v........v..v..>v..>v.v..
v.vvv...>.>>.v.>.>.>>.>.v..v>>>>...>>v..v......>.v...>....v.>.......>.v>..v.v.v..vv>>>v.v....>.....vv>..>.>....>.v....v>>>v.>v.>.v....>..v.
>..v.>v.>.vv>.v>>...>..>>..>v.>vvvvv.>.>.v>.>.>vv.>>v.v..>v..v>.v.>.......vvv>...v.>......v...vv.>..>>>v.>v>.v.>v>>>v>>v>.vv.vv.>>>..>.>v>v
.v.v..>vv>.>v.v.>.v...v.v..v..vvv.>....v.>v.v>>>.v.>>>>.>.v.v>>v>>>...>.>>.v>.>.v.v.>.v.vv>.>v.v>.v.v>..v.v..>v.>...v..>>..>..v...v.>v.>...
..>.>v>..v>.>>v>>>..>vv.v>>.>.vvv>.>..v..>.v..>>..>>v.>>v.v..v...>.>v>v.vv.v>v.vvv..>.......vv.>.vvv.....>>v..>>.>..>>.vv....>v...>..>...>v
>.>.>v...>..>.v..vv...>...v.v....vvvv.>.v...>..>..v>..>>>....>..>.....>v>........vv.>v>.v..v.......vv...>vvv..>v.vv>>v>...v..v>.>>>.>>...>.
>.>v..v..v>v...>..vv.>.>..>.>vv.vv..>>.v.>>>.>.>vvv>.v..v.....v..>...vv..v.v>...>v>>>..vvv.>vv.vv.>vv...vv.>v.....>>..>.v.vv.......>vv>v.>>
>.vv>..v>>>>...>v>.v>vv>>>....vvv.>.>..v.v...>>.>.>...vvvv...v.>.vv>>.>>.v>.>>>........vvv...>>.v.v.>v.>.>.v.v>>>>..>.>.vv>.v>..>..vvv>>v.v
..v.v..>>...v.vv...>...vv>vv..v>.>......vv.v..>..>>>.>...vvv..v>.vv....>v>.v>>..v.>>v>.>..v>vvv.>v>>.>>>.>.v>......vv.>>v.>v..>..>vvv>.....
vvv.vv.>....v.>.....>.>.v..v...v>...>>v>.v.vv....vvv.>v...>>>.>.>>v>.v...>>.>>..>v.>...>.>.vv>>v.....>.v..>>v>v..v>..>....>v..vvv>...v.v>>.
vv.>>.v.>...>..>v.v.v....>>v...>.>>v..v...v....v.>...v..vvvv...v>>.>.v>v..>.>v..>.v.v>.v....>....>>.v>..v..>.v.v...>.vvv.v.vv>>.....>>vv>v.
v..v.v.v.v>>..>..v......vv.>>.v.>.v.vvv.>..v..>>..>>>v.vv..>.v>v..v>...v>.....>.v..v>.>.v.v.>>>>..v.>>v....>>>>.v.v>.v>v>.v>......>.vvv>.>.
.v..>....v>.....v>.v>.v.vv.>v>>v>.>vvvv..v>...>.>.>....>.v>.vvv>....v....>>...>v...v..v>>.>.v>>v.vvv.>>.>vv..v.v>..>..>...vv.>>v>vv.vvv..>.
..v...>..>.vv.v.vv....>>v>.>>v.....>>..>vv.>..vv>>....>..>v.vvv>.v.v.>.>v.v..>..v..>vv..v..>.....>...v>...v>.v.v..v..>>>>>>.v>>v.>>.v.>....
vv.>..v..>...v..>vv...v.>..v...v>>.v...>..vv..v>......v>......>.v>.>vv...>>..>v.>vv....v>vv..v.v>...>.v...vvv>.vv.>.vvv.v.>vv.....v.>.>...>
.v>>..v.v.>v.>..vv>>v..>.>v.v.v.>>.>>>>>>.>v>.vv.>.v..>>..v>...>.>>v>>.....>.vv..vvv...>v...vv.>.>.>v..vv.v.>..>>...>.>.v>.......v.v..v.>v.
>.>.v>v.v>...v...>>.v>>v.>v.>..v.>..>.>vvv.v..v.v.v.v...>...v..>v.>..v>v....vv.v.>.v>>>>.>>vvv..v>.>.v.>v.>.>vv>.v.......>.vvv.v>.v.v..>v>.
>v>.>.v.v.vv.>>.v...>.>.v>....>vv.v>..v>..>..v..>vv>.>.>vv..v....>vvv>.....>.>..v.vv.>.>....v>.>.>...>.vv.v..>....v...>>..v.v.vv>>...v>.>.v
>.v....v.v..v...v>v.>>.v.v>.vv>..>.>>v>.v.>v>v>...>...>>.v>>..v.v....>..v>>.v.>>..v.v.v>.>>v.v...v>>v......>v>..v.v.>>vv>.>vv.>....vv>.v>..
>.vv>>v.>.>.v.....v>v>......v.vv.>>v.vv....vv>....>.>.>.>.....>v.>vvv>..vv.........>>>>.>.>>v>.>.v>>v..>vv.vv.>v>.v...v>vv>..>..vvv..>>v.v>
.>>.v.vvv.vvvv...v.>>vv.v..>vv.....>.v...v.v>>.>......>>....>v..>..>>>vv.>>>.v..>.>>..>.>>.v.....vv>v..vvv..>v......>.vvv..>v.v.>....v..vv>
v...v...vvvv>>..v..vvvv..v>v>>..v>..>v>...v.>>>.....v>.v>.v>>v>vv>...v...v.>.>>v>v.....>..>.v>>>.>>>.v...>..>vvvv........v...>.v>vv.>.v....
>>>..vvv..v>vv..v>....vv>.vv.v.v...>>..>>.v..>..>.>v....>v>>v.v>>..v.v.v..>vv....vvv.>>.>vv.v.......v.>>.>>....v>.....vvvv.>>.>v.>v.vvv>.>>
....v>>.vv..>...v.v>.>.....>..v>v.>>>>.>.v.v....>..>>v.v>...v>..v..v..v>v.>v.v....>..>>.vv..v...v..v>..>v.vvv..>>>v..>.>>v>v.v.>>......v...
v>....v>v>v.>.v>>....vvv>>v..>..>v>v......>v.>>vv>.vvv.>.v..v.v>.vv.>.>v>>v.v.>v..>vv.v...>>>.v....>.v.>.>>.v>>v..v>v..v.v.>>>>....vv.v..vv
v..v>.v......>.v.v>...>v..v>.>.>..v..>>.v.....>>>>v.>>.>....>.>.v..>vv.>v.v>vv>.>v.vvvv...vvv>v.>..>....>>vvv>.vv>>v>.v>.>vvv.>>.....v..>.>
>>.vv.>.v..v>...v>..v.v>>v>..>>vvv.....v.v.>>>.>....v.v>.>v.>.vv>v...>>>v.v.....v...vvv>..>>>v.....>v...v....>....>>v..>v.vv..>.....>...>.v
>>>.v>.v..>..v.>.v.v>..>>...v.>v.v.>.vv...v>...v.v>...v...v>........>v>...v...vv>>v>v...v>.>vv.......vv...>>vvvv.>....v.vv.v.v>v.>v..vvvvvv
..>>...>.v.vv>v..v.......v>.....v>>..v.v.v>vv.>>....v>>>v.v.v...v>.>.>vv.v>......vv..v.v..v.v.......>>.>..v.>..>.vv>.>..v.>.v>..v>..>.v>..>
v...>.........v..>.>...v.>.>.>.>>>..v>.v.>.v.>.>>>.....>.>.>..v.>.v...>>v.vv...>v>..>v>.v.v>>...v.v>v>v....v>.vv>v..v.>.>>>v>>v.>v>.v...v>v
>>.v>>>.>..>v>.>v.v....>.v..>....>vv>..>vvv.>>..>..>..vv..>v>vv>>.>v...>..v>>v.v...>v.v.v.....>.....>..vvv.>..v.v..v..>....>vv.>>v.>v.v...v
>.v>..>v>vv.>>vv.>.v>.v..vvv>>..v.>.>>..vv>>>......>.vv.>.vv.....>.v>.vv.v>.>v..v>.v.v..vv.>.>>>v.v>>.v.v>.>..>v.>v>.>..vvvv..>.v..>>>>>...
v>>.vv.>>.v>vv..v>.>vv...v..vv.>..v.>vv....v..v..v>>>>...>v.>.v.>v.>v..v.v>.vv>>>v.v>v>.....v>.v....>>....vvvv.v>.....vv..>v.>.>..>.v..>.v.
>.>>.....>>v..>....>.v.>v>..>v.v.......>.>v...>........>>v.>>>.>>>v..v>.....v....>v>>.v.vv>>>.v..>.>>..>>vv>v...v..>v....>>vv.vv.>>..>>.>vv
..>.>>..v.>>>...>.v.v>.v.....vv.......>v>vvvv....v.>>>.....>v.>.>v..v....>>v>.>..v>.>...v>.>>...v.v>v>>v.>>.>v>..v.v.>v>v>v>...v>.>.vvvv>.>
....v>v>.>.>...v.v...v......v...>>>.v>>.......>....vv..v..>v.>.v...........vv.>.>.>...v.....>....>.....v>v>.>>.....v>v.>>>..vv....v>..v..v>
vv..>...>>vv..v...v>.>..>.vv.v....v>>v.......>.vvv.vv>>>....>.vv...>...>v.v>>.>>>.>..v>v>>.>.....v.v.vvvv.vv.v..vv>>>...v>>>.vv...v>v..>...
..>>..v>..>>.v.>v..>.v.>...v>v>vv.>.......>>..>.v.v>.v.v>>>.>.vv..>>v>..vv.v..v....>v>...v>.v.>..>v>..vv>.>v..>.>v.vv.>v.>.......v.vv.v.>.v
v>>>>..v.v>.>vvvvvv.>.vv.>>.v.v.v..v..>.vvv>.>v..>..v....>vvv>.>v.>..vvv..>.>..>v.>...v.>>v.>.v..>...>..>....v..>v....v.v....vv...>.vv>.v..
v.>........vv>..v>.>v..v.>>.>..v..v.v>>v.....v>....v>...vvvv>.>.>>.....>>vv.>..>>v.>..vvvv>>>v.....>>>v..v.>>..>.>..vv........vv>v.v...>...
.v>>.vv.>vv>v.>...>.vv...v.>v>.>vv..v..v.>>v.>vv.>....>>>>......vvv>>v..vvvv.vv..v>>v>......v.v...>.v..v>v>v.>>v...v.v.>.v..v..v.>>....v.v>
.v>>.vv..>v..v.>.>>..v.>v......>..v>v...vv..>.v>..>..>.v.>..>.>vvv.v.....v.v.v>vvv.v>.....v>.v.vv>.v>>..v...>v.v.>>.v.v.>>..>vv>.....>..>..
..>>v>>.vv>.....v>vv.v..>>v..>v>v.>.v.v.>v.......v.v>v>.v.v.v.v.>vvv>...v..>..v>vvv>>.>v>.vv.v.>.>v>v.v>>vv>.>.....v....>>>v....>.>>..>..vv
.>.>v>.v....>......vv........vv.v.v.....v>>>v........>......v....>.v>v.v..>v>.v>vv>.>>..v.vv>......v....>>..>.>.v>vv>>>.vv.>.>..>....v>>..v
v.v>v.>...>>vv>>>.>...v>v..>>v...v>.>.....vv.....v..v...v.v..vv..>.>v.vv>..v.>.v>.v>.....v>>vv.>>v.vv..v..>....vv.>v.....v>.v..v...vvv>..>>
>>.>..v.....v>>.>>vv>.>vv..v..>vv..v...v.v.>.>vvv.v>...>v..v>>v>v......v.vv.vvv..v.>vv.vvvvv>>.>>v..>.vvvv.....vvv..vv.>v>>.>>>.>.>.>..v...
vv..v>v..v>....v>.vv>>.....>>.>>.v.>.v..>....>v>>...>.v....>.>v.>>.>>>v.v>.vv>.>.v.v.>>..v..>>>>.vv..v.v...>...>..>.>.>>vv...>....v...>vv.>
>..v.v.vv>.v.v.>.....vv.v.vv.v>.>.v>...>..v.>>vv.vvvv>.>.>.>....v.vv>v..vv>v.>>.>.v>.v.v.>.>vv>>..vv>v>.vv........v.>.v>.v.v.v>v...v>.>>...
>>.v.>>>v.>.>v.>v>>v>>....v>.vv>..>v.>.v...v>.>.vvv....v>..v..>v.vv.v.vvv.v>>.v.>.v..>....v..v....>v..>>.>..>.v........>v.>....>>..>>v.....
v.v>.>>>..>>>.>.v>.>.>>.>v.vvvv.>...vvv...vv...>>>.....vvvv>.>...v.v>v...>v>>v.vvv.v.>.v.>>vvvvv...>>v.>>..v>vv>>v..>>v..>..vv.>v.v...>....
.>.v...v..>.v..v......>...v....>>.>v>vvv>.>....v.>.v.>.v.v...v>>.vv..>>.>.v.>v.v>....vv>.v...>>v>>.......>....v.v..v.v.v.v>>...>>..>>v....>
.....vv.>..v.>>v..>>..v.>>.>.>>>>v...vv...v>..v...v...vv>.>>vv>.>v..>...>>>>>..vv...>v>>.>..v>..>.vv>.>.v.v..>vv>>..>vvv>.v.>..v>vv>v.v>v>.
vv>v>vv>>....>v>vvv..v......>>..v>v.v>.>>v.>.v.v..>>.vv....>>vvv..v.v>>.>.....vv..>>.>vvv..>..v.>v>.>.....>.>vv.v.>v..>vv.>>>.v.v...>v...>>
v..>..>..vv....>>.v...>......>.......v>..v>v.>vv.v>...>>>........>v.v.>>.....v...v>>vv..>..v..v........v.>.v>.>v..vvv.v>.vvv>>..v.v>>.>>>.v
.vvv.vvv>.vvv...v>>.>v..>..v>v>v....vv>v>..>.v...>>>>..v>.vv.>>v...>>.v.vv>.>v.>.vv>>...>v.>.>.v.>v>..v>v.v....v>>...vv....v>...v.....>....
.>......>.>v.vvv..>>..vv.v.vv>..v....v>.v>.>v..v.vvv.>vv.>..vv>.>.>>v.v>...>...>...v..>....>.v..>.v.v>.v>>.v.v>...vv.>.>.vv.>..v.v>v>v..v..
vvvv>v.v.v.v.vvv>v.v>>vv>.>>>.>>>v...v..>v......>vv...>v.v.>.>..v>.v>>.v>vvv....>>.>.vv..>...>v.v..v...v>v>v.>...v>>v.>....v.>v...v....>>.>
v>>.vv>>>..v>vv..v...>..v>.....>.>vv........v...v>..>>.v>..>v...>..vvvv...>>v....v>v>.vv........>vvvv..>.......v.>..>.>>.>>>.>..>..vvv>....
>.>...v....vv..>>.v>v..>v>>v>..>>.....>>>.>>...v.>vvv>...>.v..v.v..........vv...v..v>>.>v.>>>.v..v..>>>>..>.>..v.v>..>vv>>>.>.....v..>v..v.
.....vv.>>.vvv....v...>...>...>>.>v>v>v..v>v...>>..vv..>.>v..>..>v..>>..>>>.vv>vv>vv>>...v..>..v.v>>.>v.......v.v.v...v>.>.>...>>..vv>>v>v.
vv>>v.v.>>..>.>v>.>.v..>v..v...>v>.>>vv>v..v>..v>..>..v>..>v>.v.>.v>.v...v.>>.>v.>.v..>>>>.v..>...>.>.v....v>vv..>>..>..v.>..>..vv>...v>>.v
.v...v>.....v>.vv......v>>.>>.vv.v..v.>>..>>.>>>.v...vv......v.>v.>v..>...v.>.>>>>.>.v.....v>...>..v.>..>.v...>v>>..>...>.v>>>>...vv>..>.v>
.v>v>..>>.>vvv.v.........>>..v.>...>>.v>>>..v.v.>v.v.v.>..v.v...v>.v.>.>..v.>.v.v.v.>>.>.v>.>>v>>.>.v>>..v>..>v>.v..>>..vvv.>>>>>v.>>.>.>.>
v..>>..>vv.vv>.>..>>>v>>.vvv.>v>.>>>v>.>...>...v.>..>.>.......v.>>......>.......vv>.>..>v>>v.>v....>>>..v.>..v>.>>.vv.>v..>v.>...v>.>.>v.vv
...>v.>v.vv.>>v...>..v..vv.v.v>.v.>......>.v.>.v..>.v..v..>.vv>>.v>v...>.>>.....v.v..v.v.vv>v.v>..v.....v.>vv>....v..>>>>>v....>v...>>.v.>v
.....v>.>>.>v>...>.>>.....v..vv>v..vv>v.>..vvvv..v..v.>>.>>....>>>.vv.>vv>.>vv>...v.>>..vv.>>.>.>.vv.v>.vvv>.....v>..v.>vv>vv>.>.v...v.>...
>.vvvv.>..>>.v..>vv>.>vv>v.>.v..v.>>.vv>>>.vvv>.vv..>>.>>>>v.v.>.v>..vv>>...vv..v..vv..>.>...vv..>.....>..v..>v.>v...v>vv>.>v.>..>v..>.>.vv
..vv.>vv>>v...>vvvvvv.>>..>v......>>.....v.>>vv>>>.......>.>v>........vv>.v...vv.v..>.v>..v...v>v>>.v>v.v.>v.v.>vvv>.v>>......v...vv....>.v
.>..vv>.....>>.>v.....vv.>v.vv>>.>>>>..v..v>..v>.>>.....v.>.>>v>>.>v.v>.v.vv>.>>...>v>v..>...>.>>.v.>...v>..v.v.v....v..v...>.v>v>v>.v.v...
.v>.>...>v...>>>..v.v>>.v>>v...>v..>v>vv>.>v>.>>v.vv>.>>v.>.>..vv>>>v>.>.v.......v..v>>.>......vv..>>.v..>>...>.>..vv.>.>.v>v>..>v>>..vv>>v
v>...vv.vvv....>..>>..v..>v.....>>v>v>>>.vv..>.v....>v...>vv.v.vvvvv.v.vv..>.....>.>v..>v>v...>>>..v....v>>>vv.>>vv..>v>.v>.>.>.>.v.>.vv>>.
.>>>.v.v..>v...>.>>.vv....>>>....vv.v>>..v>.v..>.>>...>.v>>.vv>vv...>.v..>v>>...v>>...vv>vv.v.v>>v>..>>v.vv.>vv.>>>>>.vvv>..>>...v.>>.v.>v.
.v.......>.v>>...>...v.vv>>.........vvv.......>v..v..>vv..>>.>.>vv.v.v.v...v.>vv>...>>...v.v.vv>v.v>v..>.v.v..v...v>>vvv.v..>.>>.v>v..vvv..
....v.v>.>>.>>vv.v>>..v..vv.>>..vv.v..>>>v.v.v.>.>..>.v.v>v.v>v....>...v....>>>..>...>vv.v.>>.>v..>vv>.v>>vvv..>...>..v.>>vv.v>..vv..v.>>>v
..>.>.v.v>>v..>.......v>.....vv.>..vvv>.>>..>.v.v.v..vv.>>..>.v.>v>>.vv.>.>.>v..>v>.>...v...v>>>>v...>.vv>>v.>>vv>...>.>>>>.>v>>.v.>v>.v..v
.v...v.>>.>>...v.>.>>>.>.v.>>.>.v>>v>>.....>vv.>.>.v..........>.v.v.>.v..vvv.>.>..v>>vv.v..v>..>v.....>.>>.>.v>..>v.>v..>..>..>.vv>>......v
v.v>>..>.>>>.vv..>v.>..>..>v.>v..v>..>v.>v.v.>.>>.>...>>v>v.....v..>...>.>>.>..v.>.v.>>.>...v>..>...v.vv>>..>..v.>>v.....>.v.>.>>>...>>>v..
v....>.v>v.v.>v...v.>vv>v.vvv...v..vv>>.....>v.>v.>>.v..v.v.v.>v>...v.v...vv..v.....v.....>v....>..>vv>.v.v>>.>>.>.v..v>vv...v>...>>v.>>vvv
v>v>.....>>..>v.....v..>.>..v.......v>>.>..>>....>.>>>.>.....v>>v.>v..>.v>.>.>.v>vv...v>vv>v>.>v>v.vv...>vvvv..vvv>vvv.v..>..v>vv....v...>>
.v.vv..v>v...>>v.>..>>>>.>.>vv......vv>....vv.v..>.....>vv>>>..v>>v..>...v.vv.....>.>....v..v.>.>...>>.>.v>.>...v>v>>v>v.>..>>.....>.>v..v.
vv..>.v>>>>.>>..v..>>.>.>vv...>..vvv....>vvv>v.v..v.>..v..vvv>.>v>>..v.v...v...v..v.vv...v.>v>.>..v....v.v>vv..>..v>>...>v.>.v...>v...>.v>.
...>...>...>.>vv..>.vv..>>..v.>...>>...>.v>.>...>...>..vv.>>v..>.vv.vv>v.>v.v....>.>.>v.>>.>..v>.>.>.>>v.>..>..>v>....vv.>..>.....>v.v.>..v
.>.v.v>.>.>vv>>v..>..>.vv...v..vv>..vv.v.>..v..>.v>>>>v..vvv...v...v..v.v>..vvv.>vv>>..>>....v.vv...>...v>>v..v>v....v>.v.>>v>v.v.v.>v.>v.>
......>.>>.v.>>..v>v..>v..>>.v>>.>v>.vv>>..vv>vv...>.vv.v..v...>..>..>>vvv.>...>...v...>>..vv.v>.>>>vv....v.v.>.>vv>v>..>.>v.v>>.....>.>.>.
......>v>v>.>.>..>v>vv..v.>>>.v>....vv.v>v...>v.>..>v>.v.....>.v>v>vv>..>v>>...v>...vv.>..v...v.v..>v...>...>..>>v>>>>vv.>>.vv>v>v>.v.>....
..v.>vv.v>v.>.>v.v.>vv>...>v>>>.>...v..>>.>vvv..v..vvv...>..>.v...v..>..v..v..>v>>.v..>v.>.>>..>..v.v....>>.>.v.>v>.v>>v.v.v.>.>>v.....>>>>
.....>>vv.>>..>vvvv>.vv.vv.>>...>..>>>v...vv.>>v.vv.>.>....vv.>v.>..vvv.>..>>..>>v..v>>>>.>>.>.v>>>....v>.v>.>.>..v.....v>>.v>......>.vv...
v..v.>>.v.v..>v>.>v..v.v>.>v..v.>vv.v.>>..>....>vv.>v..>.>v>>v>.>v.......v>v.vv.v.>.>v.>..>.>....>..>v.....v..>.>.vv.vv..>v.v.>>...v......v
v>v.....>..v..>.v..v.vv...>v>...v..>>.v..v>..v>..>.....v.....>...vv..>.vvvv.v>.vv>v....>..>>>.v.....v.>v.>.vv>.>.v.>>...vv.....v.>vv.....>>
>>v>>.v.>v..v>.>...>>.v....>.......v>vv..>>vv.vv.v>>>>v.>>>...>..vv...vv>v>>v.v.>.>v.>v>..v>>.vv.>.v.>v......>>....>...>v......>v.v.v>v.>>.
v.v.vv>.>.>...>>.>>>..>.vv..>.v.v>>.>>v.v.v..>...>vv..vvv..>.v.>>>.>>..v.v...>>.>.v.......v>>v>>....>..v..vv.vvv...vvvv.>v..v.v>>>....v.>>.
v..>.>..>v.v.>.......>.v.>..vv.v>>.>v...v>...v>....v>...v.v.v......v>v..vv.>v.v......v>vv......v.>v>.v..v..>>vv>..v>..v...>.>v>vv.v>v...v..
.>.........v......v..>.v.vv.v>...>>.vvv>>>vv>>.>v.v.v>..>>..v..vvv.v>>>.v.>.>v...>.v.>vv.vvv>>.>v.v.>..>vv>.>>v.....>..>..v>v>.>>>.>.v>>.>.
..>>v.v.>v...v..vv.vv........v>>.>>v......>>..v.>>.>v..v....>..v...>....>v>..>>.v...>.v.v.>v...>v>.vvv>>.>v.v.v.>v>>.>.v>>vv.v.>.>.v.>>>v..
>....v..>..v>...v....>vv..v>...>v>>.......v..>.v..vvv>....>>v>......v.....v>vv.v....>...>v>>>>..v>.>...v...v....v.....>.>.>vv...>v>.>.v>..>
...>v..>>>v.v..>.v.>...vv.>>>>>v>..v..>..v....vv...>.>.v>.vvv...>>vv...v>v>..>.vv.>.vv>.....v..v>>vvvv>..vv.>v>v>...>>v.v>...>.v.v>>v>vvv..
..>.vv.v.>.v>.>..v>.>.v.>>>>.>.v.>...vv..>>v>>v..vv>>...v..vv>vv>>..>v...>>...>>.>.>....v>>>.v.>..>v>.>>.>..>v.......v...v..vv>vv....v..vv.
v.>.....>>.v>vvv>.......>vvvv.>v.>.>..>.vv..>..>..v...vvv>v>>>..>vv>v>...v>>.v..>.v..v..v>v.>...v.>..vv>..v.>>>..vv......>.>vv..>v........v
>v.v..>>..>>v...vv..vv>.vv>vvv.>..v..v..>...>..v.....>>......v.vv.>.....>.>...>.>v.v.v>..v.v>>>>>>v.v.>>>vv..>.>.>v...>.>vv>.v.v.vv>...>..v
..v..vv>v.>.>>vv...v..vvv..>>v>.>....>>.v.>>vv....v>>>v.....>>>.>v.v>>.>...v.v.>>vvv...>v.>.>v>...v>..v.>v.v...v.>v>>...>.>.>v.v.>v.vv...v.
.>>>.vv..>v>>>.v..vv>..vv.>.>....v.vvv.>..>.v..vv.>v..v.vv......>.vv>>..v>v>>>v.>>>v>vv>>>.>v>..vv...v>.>>..>vv.v...>.....>>v>vv..>.....>..
>>.>vvv.>.v.v>...v>>.vv..>....v>>.>.v..v...>v..vv.v>....>.v.>vvv.>>.....v..v>>v..>.>>>.>.v...vv>....>>...>...>......vvv.v......v....>...v..
.>.v.........>v.>>v...v...>>.vv.v..>..vvv>v...>.v>vv..v>vv>..>.>.>.>.......>.....>..>..vv>.>>..>>..>..>..vv....v.v.>>.>>v.v..v..>....vv.>.>
v...>>>.v>>.v....>..>>.vv.vv....>.>....v....v.v....>....>..>v.vvv>..v>>.vv>..v>...v....v.>v>.v...>>..>.v>..>>vvv.v..>v..v>..>>.>>v..vv>..v>";
            var grid = input.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries).Select(s => s.ToCharArray()).ToArray();
            int rows = grid.Length;
            int cols = grid[0].Length;
            var east = new HashSet<(int, int)>();
            var south = new HashSet<(int, int)>();
            for (int i = 0; i < rows; i++)
            {
                for (int j = 0; j < cols; j++)
                {
                    if (grid[i][j] == 'v') south.Add((i, j));
                    if (grid[i][j] == '>') east.Add((i, j));
                }
            }
            int moves = 0;
            int steps = 0;
            do
            {
                moves = 0;
                steps++;
                moves += Move(east, 0, 1);
                moves += Move(south, 1, 0);
            } while (moves > 0);
            Console.WriteLine(steps);
            sw.Stop();
            Console.WriteLine(sw.ElapsedMilliseconds);

            int Move(HashSet<(int r, int c)> cucumbers, int dr, int dc)
            {
                var list = new List<(int r, int c)>();
                foreach (var cucumber in cucumbers)
                {
                    if (grid[(cucumber.r + dr) % rows][(cucumber.c + dc) % cols] == '.')
                        list.Add(cucumber);
                }

                foreach (var l in list)
                {
                    cucumbers.Remove(l);
                    grid[(l.r + dr) % rows][(l.c + dc) % cols] = grid[l.r][l.c];
                    grid[l.r][l.c] = '.';
                    cucumbers.Add(((l.r + dr) % rows, (l.c + dc) % cols));
                }
                return list.Count;
            }
        }
    }

}
