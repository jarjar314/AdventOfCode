using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.ComponentModel.Design;
using System.Linq;
using System.Text;

namespace AOC2023
{
    public class Day12
    {

        public static void Main()
        {
            var input = @"??#??????#..????? 9,2,1
???##??#?.?#? 5,1,2
????.????. 1,1
.?#?????###???. 1,6,1
????.?#????#?? 2,1,1,3
??.??.?????#??##.??. 1,1,10,2
??.?###?#??????? 2,7,2,1
?????..#??? 4,1,1
#?????.?#???.#.???# 1,2,4,1,1,1
??#??#???????.?#??? 1,1,7,1,2,1
?..??#????#?.? 3,1,2
..#?????.#.??#.? 1,3,1,1,1
?#.?.?.??#??#?#??? 2,1,1,10
???#???.##?#?????#.? 1,1,1,6,1,1
?.??#?#?#?#?? 1,8
?#??????????? 2,4
??????????? 4,1,1
????.??#?. 4,3
??###??????? 6,1,1
?.?.?#???#?. 1,5
??.?#?..???.???###? 3,1,7
?????#.????? 3,2
#???????.??????#?? 1,4,1,2
?#??????????#??. 1,11
?.????..?..???##? 4,1,6
??????#???#?#?.# 9,1
?#?#??#?##?##?.#??. 10,3,3
??##?#?##????? 8,2
???#??#?.?.???? 5,2
?.??.?..??????.????# 1,2,1,6,3,1
?..#????#???#??.?.?# 1,1,9,1
.?#?.?????. 2,1
???##.???#???#???? 1,2,5,3,1
??????????#?.?.??.?? 9,1,1,2
.#.???????.???#. 1,1,5,1
??.??????##?.? 1,2,4
?????.??.#?.#.# 1,2,1,1,1
#?????.???????#.??? 1,2,1,1,2,2
?#?????..#????#? 6,1,4
.??????.???#??? 5,1,1
??????.?#??# 5,2,1
??.?#?.?#?.#??? 2,2,1
???#?.#???.?. 4,3,1
???.?#??##..##??.? 1,6,3
???##?#?#.#???.?#?. 1,7,3,3
#.?????#??????? 1,1,1,6,1
?#.?.???## 2,1,2
?.???#????? 1,2,1
?.?#??.?#?#??.#.?#?? 1,1,6,1,1,1
??.????.??#? 1,1,1,2
??.#?#??.???#??#?? 1,1,1,1,7,1
.?.??.#??? 1,1,2
????????##?#??#?..? 6,1
?.???#?#.?.?#. 1,5,1,1
?.??#???.??. 4,1
???.???.?#.?#??#?.?? 2,1,2,2,3,1
.#????#.??#? 6,4
#?????.???##?? 4,1,1,4
..????#??????????# 10,3
#????##?#..? 9,1
?#.?.?#?.? 2,1,1
?#?.##???????.????? 3,4,2,3,1
?..?#??##????????# 1,7,1,1
??.?#.??????????. 1,2,2,6
?????..?#?????????#? 1,1,8,1,2
??#???????. 1,4
?????????##.?????? 1,8,1,4
#?#.?.??###??#????? 1,1,1,9
??#????#.??????.??## 1,6,2,2,4
...#?.?###? 1,4
#.?#..???#??. 1,1,1,3
.????.???? 1,3
.#??..???????.?? 1,1,5,1
.???????????? 3,1,4
?..#????????.?.#?? 1,3,1,1,1,1
???##??.???.#? 2,2,3,1
??#?#?????????. 7,1,1,1
???###?#??.???? 9,2
??#?.??????.??##???? 3,1,2,4,1
????.???.? 2,1,1
?..?...#??????#?.?? 1,2
????#???#?????? 4,1,6
??####??????.#??#?? 8,2,1,1
#???????.??.??. 5,1,1,2
????#?#??? 1,5
.????????? 1,2
???????#?. 1,2
?###..##?. 3,2
.??#??.??????.??#.#? 2,1,4,1,1,1
?.??###?#.? 5,1
???##???#?#?.#?. 11,2
.??#???..?#?????#? 3,5,2
???#?#.???#?? 1,1,4
?.??.??.?? 1,1,1
???.???#???#?????#? 1,12
?#??????#?.?#? 3,1,3,2
?#??.?##???.?.?. 3,5,1
????.?????# 1,4,1
.???#???#??#.?.??? 2,5
##??????.?????? 5,1,1,1,1
.?##?###??#?? 7,2
#.????#?????????#??# 1,2,11,2
?.??.?#???????? 1,1,10
???#????#?? 2,1,1
????..??#? 1,2
.??..????##.? 2,5
?????.#??? 1,2,1
?..#.??????? 1,1,4
??#??#???###?# 5,3,1
???.?#..#? 1,1,1
??#?????#??#????##?? 1,2,1,3,1,6
??????????###??.?. 2,3,3,1,1
??#???.??? 3,1,1
????????.? 1,3,1
?#??.??????.? 2,6
???.#????..#??#? 2,1,3,5
????.?#??#? 2,2,2
??.????#????#????#. 1,1,5,1,1,1
??#.????##?#??# 1,8
?#???##?#???.#????. 8,2,1
#?#????#?#?.#?. 1,8,2
#??#??##?#???. 1,10
.?????.??? 5,2
?#???????.?. 2,1,1,1
?.##???..??#??###?? 5,1,8
?.??????#???.?#? 1,7,1
??.#??????.?.#???#? 1,4,1,1,3
.?#?????#????# 2,10
##??????#..? 2,2,3,1
#?????.??????#?? 6,2,2
?.#?????#?# 5,1,1
????.???#????????? 4,12
???##??.??????? 5,3,1
#?????#.?.??.#?# 1,1,1,1,3
??##??#?#? 4,1,1
???????????.?? 1,3,1,2
.?????#.??#. 2,2,1
#.#?.??##????#????? 1,1,1,7,1,1
?.??#.??????? 1,1,1,2
#?.?#??#?????.?.? 1,5,1,1
?.?.??#??? 1,4
???#??#?.?.????#.#. 7,1,2,2,1
..???#????????#? 5,1,1,2
##????..#???? 3,2,4
?.?.#?#?????.#??#?? 6,1,4
???.?##???.????.?? 2,4,1,1,1,1
??#????.?#?. 4,2
?#???????#?#???#? 3,1,7,2
????..#???? 2,5
?#.?????????? 2,1,3,1
?????.??##?#.#????? 1,1,6,1,2,1
#??#??..#? 1,1,1
?????#????#??#???.? 2,8,1,1,1
.????##?.#????#?. 4,6
.?.???.#?###.? 1,5
?.??##??????.#??# 8,4
?#????#??#. 2,5
??#??#.#???#???# 1,2,2,1,1
.#?..???.#??#?????#. 2,1,1,2,5,1
?.???##??#?##.? 1,7,2,1
?#??#?#.??.?.? 3,3,1
??#???#???#????. 11,1
.###?????????? 4,1,3
??#??#????..###?.?? 6,2,3,1
#???.##?.?? 4,2,1
??.##??#??.????# 6,4
????#?????. 1,7
???.???????#???#? 2,1,10
?????###??.?##?? 1,5,3
???#.##?#???#?#??? 2,1,8,1,1
?..?##?.?????#? 1,3,5
????????????###???? 1,1,2,1,8
#??.?#?#?.?????#?. 3,1,1,1,1,1
?.?????.?#??##??# 2,1,3,5
???##?#??????#.??? 10,1,1
??.?###?#? 1,6
???###??????? 6,4
??????#.?.#??? 1,2,2
.?.?.??#?????#???#?? 1,1,8,2
?#..??????#.????. 2,1,2,1,2
.??#?.????##??#.?.# 1,2,7,1,1
??###????.???#???? 5,2,2,2,1
?#???#?#..?? 2,1,1,2
?.#?#??.???? 3,3
.???#?.??????###???? 3,9
????.##?????..#??.? 1,1,3,1,1,3
????????.??????#? 1,3,6
????.#.?#?#?????#??. 2,1,11
#???????#? 1,1,1
?????##?##? 3,6
?#???.??##?#?????.# 1,2,7,1,1,1
.?.#??.??.???##???#? 3,1,9
#????????#???.??? 2,1,1,5,1
????#??.?.?#??###?# 2,1,1,1,9
?#.??..??###???? 1,1,1,5,1
?.??????.?#.?.?#???. 6,2,1,2
????#??????? 1,6,1
#?.??.??#?.??#??? 1,2,1,1,5
.?##?????#?##??.? 5,6
?????..####????.? 4,8
?#?????###???????. 9,5
?????????#???..? 1,3
??#?.???.?.?.?? 2,1,1
???.??????#??#??#. 1,2,1,1,2,1
.#???###??#???.?#??? 11,3
?.???.??##?. 2,3
???#???????##??#? 4,1,5
.???#?.?????## 1,1,2,3
?..????##????.??#.?. 7,2
?#?#.??#???.????#.? 4,6,1,1
.#??????##??##.?###? 2,2,4,2,3
?????#???##???.##?. 1,4,3,1,3
#..???##???##?.??#. 1,5,4,1
.????#?#..????#??. 6,2
??#??.???#?####. 2,1,8
.???.??#?? 1,4
?#?..????#??????? 2,9,1
????#??#??#???.?. 6,4,1,1
???????#.?..?? 5,1,1
??##?????##.??.????? 11,1,1
.#?##?????. 5,1
#.??????#??????? 1,10,1
??#??????.##???. 1,1,1,1,4
?????#??#?. 1,1,2
?.?#?#??.?.#???? 4,3
#?#.?#.????? 1,1,1,1
??????????#? 5,1
??????#?.?##?#?????? 3,7
.????????.?...? 1,2,1,1,1
??##???##??#.???? 1,2,4,1,3
???#?.#????? 1,1,1,2
.??????.????.??#? 4,3,4
??????.??????? 1,1,2,2
????..#??#??? 1,2,1,1
??#??????#?????.???. 10,2
?..#???..??..?.? 4,1
??#?#??#??.#.??#? 7,1,1
..?#???.?.?????? 5,3
?.????#???.?#?? 1,2,4,2
.?#????#??.?? 5,3,1
.#.????##??????????# 1,17
???????.???.# 2,2,2,1
??##?????.??. 7,1
?.?.????.??? 1,1,1,1
?.????????.# 1,4,1
?????#??..#?#.? 1,1,3,3
?#?.#?##??#?? 1,5,2
?.??##??#??#???? 5,4
?.?##?..???###??? 3,6
??#.??#.??.. 2,1,1
#?##?????????#???? 1,2,1,6,2
?.?????.?????#??.#.? 1,1,1,8,1,1
??.?#?.#?##????#.? 3,5,3
..??.????????..? 1,2
.???..????.???..? 3,2,2,1
?.?.??.???. 1,1,1
????#?#??????.??.??. 8,1
??#????????? 4,1,3
??#??????..#?#?? 2,1,2,3,1
?#??#.???# 1,1,1
??#?????#?? 2,4
????#.?#???? 5,1,2
??.???#?????.??#??#? 1,3,1,6
?#.?#.????.#? 1,2,2,1
#?#??#????.?.??????? 8,1,1,2
??##???#.??. 4,2,1
?##??#???.? 6,1,1
?.#?#.?#??????? 3,5
?????#???#..?. 1,8,1
??#..#????.. 2,1,1
?#????.?#?. 2,2,3
?.#????#????###?? 8,3
????...?.?? 2,1
##.????#?????.?##?? 2,5,4
.?#????.???? 6,1
??.?????..???..??? 2,3,3,2
???????#???#???????? 1,1,8,1,1,1
.?.???.?#??.?.?? 1,1,3,1,1
????#.????###.?? 1,1,1,7,1
?.?##?#???.#???.? 5,4
????#?...??.##?????? 2,2,1,5,1
??.???###? 2,6
??.??.?.?##???. 1,2,6
???????#???#?.??#??? 10,5
?.???????#?#??. 1,8,3
..?#?##?.???? 4,2
.?##?#?????. 5,1
?#????#?.??. 1,2,1
??#?#.???????. 3,3
???.????#??.# 2,7,1
????#?.#????????? 5,1,1,1,1
????##???????? 5,1,1,1
???#?????..?#? 2,5,3
?..??##.?????#.?? 4,1,1
.?#????.???#####?? 4,2,7
???.?###.???.? 4,2
?#?????.?#???? 6,4
???#?.?..????? 5,1,1,2
??.#??????####??? 1,1,2,1,7
?.???????#? 2,3
..#????????#? 8,1
?#?##?##?##????. 12,1
?#?.??.?.?# 2,1,1
.?.?#???#?.????. 1,6,1
?#???.??.???????? 5,1,1,2
???????#?#??.?..?? 1,6,1,1,1
???????#???.. 3,1,1
..??#?????????? 1,2,6
??????##?????#???## 8,1,2
??????.#?####?#?#??# 1,1,1,6,2,1
#?#????..#?.? 1,5,1,1
?##???..?#? 2,1,1
.????#.????.??#?#. 1,2,2,3,1
?###??????#. 5,1,1
.?##??#?????...???? 9,4
?.???#?##?#??? 1,10
???.?.?#???#???? 2,1,3,2,2
?????##?##?#? 2,2,2,2
????#???## 2,2
??##..#.??.? 4,1,1,1
??..#?#????? 4,1
.??#??????#?????#?? 3,3,3,4
#?#??#?#??#??. 6,1,4
???##????.?#. 5,1,2
??????##?????# 7,1,2
#??##?#?#????#?????? 12,1,1,1
?.?.???.???. 1,1,3,2
???#.??#####??##?? 1,1,12
??#?##.?#.?? 4,2
?????????.???.??#?. 1,6,1,4
?.#??.?#.???.?. 1,1,2,1,1
?.#????#??.??? 6,2
#?..?#?#???###??#?? 2,14
????????##?????.?#. 3,5,1,2
.#??#?..?????#????? 2,2,8,2
#?????#?????.?.?# 1,1,4,1,2
???#???????? 1,2,6
???????.?..? 1,1,1,1
..?#.?#???.#????#?. 1,3,1,1,1,2
.??#?????##????##.?? 11,3
.##?.##???##?#?#??? 3,11
?##???#.????#??.#? 7,1,1,3,1
???.??#??#?????????? 1,1,1,10,1
?#.#??????#????#???# 2,4,3,7
.#????#?##??#????#? 2,8,3
????????#???.???#??? 1,5,1,2,1,1
.#??????#? 2,4
#?#?????????# 3,5,1
..??#??.#?? 1,1,2
??.?#????.??? 3,3
???#?#?##?#?????? 11,1
#?????#?##???#?.?.?? 4,8,1
?#??.?#??. 2,4
???????..?#?.??? 3,2
?.##?#?.????##?. 5,4
???.#???????????##? 1,7,2,3
.??#?.??#??? 1,1,4
??.??.?#??? 1,4
..?????#.?.. 1,1
??????.???#?#?##??# 1,1,1,1,6,2
??##?#..#??##?#???.? 5,7,1
???#?#????#?.#. 1,5,1,1
.????????? 1,1,1
?#??????????????? 6,1,1,1,1
?.?##???..#. 1,2,1,1
#?#????.#.?????##??. 3,1,1,7
?????.?#?#??#??????? 1,1,1,6,5
??..?.??.#????# 2,1,2,4,1
?##??#??????????.? 9,2,1,1
#?.#..?#?### 1,1,6
???#???.???#??#.?? 1,1,1,3,1,1
?#?????.?#????#???? 3,9
.??????.??.? 4,2
?#?#?.?#??#?#???? 4,2,2,1,1
???.#??#?##??? 1,1,6
??.?..??.?..#????. 1,1,2,1,2,1
???#?????. 2,1,2
.???#??#??? 3,4
#????#?#???? 1,2,3,2
??#??.#?... 2,2
??.?.??#??#?. 2,1,5
???#??????????? 8,1
#????#?????# 2,7
??????.#.##?? 4,1,2,1
?.?.?#?###??#? 1,1,6,2
??.?.?#???#???? 1,1,8,1
?###?..??????.#?.??# 4,5,1,1,1
??##?#???????##??# 6,8
???.?????.????. 1,3,1
????#?????????#??? 9,3
??#???#??????#???? 10,3
.??.##?#??#???#??.. 9,2
..#?#?###???.? 7,1
?????#??#???#??.?.? 2,6,2,1,1
??????.???#????.? 1,8
.?????.#.##? 2,1,2
?.??#?#??????? 1,4,1,1
??#???#.?.?#??#? 2,2,2,3
.?#?..????# 2,1,2
.??##??#?#??? 4,2,1,1
?#???#?#?#..? 2,3,1
.?????###????. 1,5,1
??.???#???#?# 1,8
?#?.#?#?#??.?#?. 2,6,2
?.????#??#???.?? 1,7,1
?.??...???? 1,2,1
.#?.?#.?.???? 1,1,1
.#?##??????? 5,3
..#?#??.#????#?? 3,7
?.?#??##?#?????##?? 1,1,7,2
??????#..?#????? 6,2,2
??#.??.?..?.???? 2,1,1,1,2
???..???????? 3,7
???????.#.??????. 1,1,1,1,6
?#?.??.?#?#?#??????. 2,1,6,1,1
.?#??????. 1,1,1
.?##??#.????? 6,1
?.?#?.?#.?? 3,1,1
?????.????? 1,1,2
??.???????#?? 1,5
???????#?.???.????? 3,2,1,2,5
??????????##?????? 2,2,6,1,1
??#????.?????#?##?# 2,1,9,1
??????#?#.?.?. 8,1
?..#?.??##.?.?? 1,2,2,1,1
??..#??##.?#????#? 1,1,2,1,4
????#?#..?.#?????? 7,1,1,5
.#??????????.???.? 6,1,1,2,1
#?..???.?? 1,3,1
..?????.??.??# 2,2,2,3
.??????.???#??.?? 1,3
..?#.?.????.#?????? 1,1,2,7
??#?#?.???????.? 3,1,1,3
????#??????????## 11,1,2
##??????.???????. 5,1,1
#????#????#?##? 1,10
???##???##?#?????#?? 15,1
????.??????#?#?? 2,7
???#??..?#??##?? 3,8
.##?.#.???? 2,1,2
.?#?????????#?##?#?? 2,1,8,1,1
???###..?#?..??###?? 5,3,1,5
?#?.??#?#?. 1,3,1
??????#?????#??.?.# 1,6,5,1,1
??????#???.# 3,4,1
??#?.??.?##.?#? 3,2,2
????????..??.?.. 1,1
#???#??.????# 7,1,2
??????.?#??. 1,1,1,2
?.#???#???????.? 1,6,1
#.#.##????.#? 1,1,6,1
?.?#?????.?#?#? 4,5
??.?#????? 1,1,1
.?##?????#.????.??? 7,1,1
####.#???#.?.???#?#? 4,1,2,6
???.##??#???##????? 1,1,14
??????#??#??#?#???? 7,1,2,2
.#.????##???????? 1,9,3
#??#?.???##?? 2,2,2
#??#?.??.? 5,2
?#?##?#####????#.?# 12,1,1,1
.?#?#??#??#?????.. 10,2
?????.???#????? 3,7
?.????#.??.??.???##? 1,2,1,1,1,4
?????#??..?????##? 6,7
?#??#?.???????##? 1,1,1,1,3
?##?????.#.?#? 8,1,1
.?#????.??? 4,2
#????#???#????.?#?? 1,1,8,3
?.??????#????#???# 1,1,1,7,2
???????#?#?#?? 2,7
??#?????.#? 3,2,1
?#?.??.?..#????.??## 1,1,1,5,1,2
?????..????????. 2,1,4
.???#?#??#??#?.???? 13,1,1
.#?..???????? 1,1,1,2
??????#??????? 3,9
??#?.??.?.????#???? 4,1,2,2
??##??.????#? 3,1,1
.???##?.?????###. 4,6
?#.??#???#? 1,5,1
????.???.????#. 2,1,5
??.?.?#?????#?. 2,3,2
?.???##??##.????? 9,1
..?.??????????#?.??? 1,1,9,1,1
#?.##??##??#???.? 1,7,1,1,1
#???.#?.????????.# 3,2,3,1,1
?#???#?.#?????## 1,2,2,1,2
.#?##?##??#?# 1,10
?#?##.????.#?????? 1,2,2,1,2,4
#..??###????.#? 1,5,2
.???#??????##???#?? 8,4,1
?.????#???????????. 1,9,2
?#??#????##?.??????? 11,1,2
??#?#.???? 5,1
#?????.???# 4,1,2
???#??#???????????? 2,2,1,7,2
????.???#?????? 1,1,1,1,3
?????????.???#????? 9,1,3,1
??????.??.??.???.??. 4,1,1,2,2,1
???.?#???????#??? 2,4,2,2
###???#???#??.??##?. 7,5,5
.?????####???????? 6,1
????.????? 1,1,1
?????###??#???? 2,5,5
.??.???#??.?.???. 2,5,1,3
#.??#????.???### 1,3,3,1,3
????????#.? 1,3
????##??#.?????. 1,3,1,1,1
..#????#..?#?????? 3,1,5
??#??#?#???#?.? 2,2,2,3,1
###??#?????.?. 4,5
????.?#???.?? 3,2,1
#??????..??#??????? 4,2,2,1,2
???#?#?..#??.??? 4,3
???#????..?? 8,1
#?.?#?????? 2,2,3
??#.????.????## 1,1,1,1,4
???#.?.#?..? 1,1,1,1
#??#????#??##?#? 6,2,5
.????.#???. 1,2
?????.?????.??##??.? 3,1,1,2,4,1
.?#??#??.?. 2,4
????????#???..? 2,6
?#???##???#?.?..??# 8,2,2
.??#?..#????.?? 1,5
.??????#???.?#?#. 1,4,3
????.?????#? 1,1,1,2
.#.?.?.??? 1,1,1
#??????.#? 3,2
?????.#?##?.???#. 2,1,5,2,1
???#?.?.???##??.?. 1,4
?##???????? 4,5
?#?#??#???#??.#?#?? 3,8,4
##?????#??????? 2,5,1,1
????.?#??..????##?? 1,1,1,1,6
????.#???.????#??#? 1,3,1,3,2
?..???#??###???? 1,1,8
??#?#??#???? 3,4,2
#????.??.#?? 5,1,1,1
?.????##???#?????.? 1,11
??????..?.?#?.??. 1,2,1,3,1
?????.?#?? 1,1,1
.?.????????# 1,2,5
.?.?.#?#.????. 1,1,1,3
.???.??#?????#?? 3,10
???#?#????.?? 5,2,1
??#.???.?? 2,1,1
??###??????.?#?? 11,3
??.?????????#?. 2,2
.??#?#??##???????.# 12,1,1
.##??????????.. 3,1,1,2
?????##.?#??.#?.??# 1,1,2,1,1,3
.??..???#??#??.# 2,1,1,2,1
??#.?#.#?.?##?#?#??# 2,1,1,6,1
?.??.??#??? 1,1
#?##??.?##?#?#?#?? 5,10
.??#?.#??#. 1,2,1
?#??????#?.?? 1,5,1
##???..???#?..?????? 2,2,4,3
??.#????.#?? 1,1,2,1
?.?#.???.???? 1,1,2,1
.???##?..?..?#?.??? 3,1
?????????.##????.??. 7,4
##???#?.??.???. 3,1,2,1
????????#..#?.?##?.? 9,2,3
?.??.?..?#. 1,1,1
???????.?##. 5,1,3
#?#.#.???????????##? 3,1,6,6
?.??#??????? 4,3
??#?##???.##? 8,2
???.???.#????.#?.? 2,3,3,1,2
???????##???? 2,2,4,1
????##?#???? 1,7,1
##??..???? 2,1,1
?#??..??.? 3,1
?.??#??#..????.??? 3,2,1,1,3
#?#..#?????#??.? 3,1,5
?????.???????#??. 1,3,2
?.?#????.?? 4,1
?#???#????????#? 11,1
#????#.#??#????#?#?. 1,3,6,3
?????##?.##??.? 2,3
??.??#??..??? 4,2
?#?#???#??#??##????? 1,8,4,1
?????.?.?. 2,1,1
?.?#..???##??.?. 1,1,5,1
??##???#???#?#.?.?. 1,8,1,1,1,1
?#???#??????.???#??. 10,2,2
#?.???#??#?.?????? 1,7,4
???????##?#??? 1,1,8
??.?????##?? 1,1,5
??#??##??##?????##?? 2,2,9,1
?.?#??#?##?.???????? 8,7
???#?#?#?#??????.?? 2,1,11
.????????..?? 1,1,2,1
?#??#?.??.?#? 4,1,1
???.?????#.?#??.. 6,3
#..?#???????. 1,8
?.???##?##?##??#?..? 14,1
?.???..??.??##?? 2,2,2
????#.#?.? 1,1,2
??????#??????#??? 1,4,1,4
?????.?.??. 4,2
?##??..#?.? 3,2
#?.??#.?##??#??#? 1,1,1,8
??#??##?##?#?#?..? 2,10,1
??????##??????.???? 1,10,1,1
?????...?# 3,1
?#?.?#?#?.?# 3,1,1,2
.#?.?#.?#? 1,1,2
??#????????#???.???? 13,1
.????????###????#. 2,1,8
???.?##??.??????# 1,5,1,2
????????.?? 1,5,1
??.?#?##???#?#.. 5,3
.#????????#?#? 3,4,4
???????.??#??? 4,4
##..????##?.?.?. 2,2,4,1
?.???????#?#.????#? 10,4
.?????#??.????#??. 5,1
?#.##??#?????. 1,7
?????????.????? 6,1,2
.?..????#? 1,4
?.##???????#?? 1,3,5
??#?????#??#?#?????. 2,11
.?.???????## 1,6
#???..?.?.?? 3,1,1,1
##?????..??? 2,1,2
#?.??.???????#.???? 1,1,1,2,2,4
?#?#?????.?.?? 4,1,1,1
?????#?#?.???.?.? 8,1,1,1
??###?#??????.?.#?. 10,1
?#????.?????.?? 1,1,4,1
?#?#???##?#??#??#.# 1,1,7,4,1
#.?????#????? 1,1,6
?..#??.???. 1,2
????#?#??.???. 1,5,1
.???.?????#?##?..? 1,8
#??#?#???????.#???#? 6,4,1,1,1,1
.?.##?.?..??????? 3,5
??.#???.#?#?.???#??? 1,4,3,1,1,2
.##?.??.?## 2,1,2
?##.??#.?#???#? 3,2,1,3
.??????#?????? 8,2
#..?????#????#.?#?#. 1,6,1,1,2,1
.????.??.?#?? 2,2,3
?#?#???????####.?#? 3,1,4,3
?#.????#.?.??? 1,1,2,2
???????.?#??#????? 1,1,9
.#?##.????? 1,2,3
???#??#?.??.?. 8,1
..??#??.???#???.? 4,4
???#??##???##??????? 13,1
?????#.?????#???#? 1,1,1,1,4,1
????##????.??.?##. 6,3
#???.#?.?#? 1,1,2
##???????#?#.???? 10,1,1,1
??#??##??#??.??.?.? 10,1
?#??#?#????#????? 1,9,1
#???????.##?.?#???? 2,1,3,2,2
?###??#?#?.#..??? 10,1,1,1
??##??.?????.??. 3,1,1,1,1
??#.?#???.?? 1,5
?##?#????##??#? 10,1
???#??????##?#???? 2,10
???#?.??#??? 1,1,4
???#?#????##?#?.?? 13,1
?#??????????.??. 2,4,2
?#.?##?#?? 1,4
????????..? 1,1
.??##?#???? 5,2
?##???#????###? 3,5,4
??..?.???????##?? 1,1,8
??#?##?????##??. 8,3
.##?..#?????##...? 3,8
????????#??.???# 10,1,1
.??????#?????. 1,1,5
?????#???#. 1,3,1
#.?#.??#.???##.. 1,1,2,4
??#.?.??#? 3,1,1
?.?.##??#??#.?.# 1,8,1,1
??????##?#?#? 1,5,1,1
??????#?????..????? 3,3,2,5
?##?????#.? 5,1,1
??????.??#.##???? 2,3,3,1
####???????#??#?# 6,1,5,1
.??#??#.?#.????##??# 1,1,1,2,1,6
#?#?#?#????????.?? 9,4,1
???###?##??.???. 1,8,1
???##???#??#.??? 2,6,2,1
???.??#????? 1,6
..?????#?. 1,1,1
#?#??.#????#? 5,6
.????#?????#?? 5,1,1
??.??.??#.??????.# 1,1,3,1,1,1
???????..#?#??#. 5,6
??.???###??##?????# 1,1,12,1
???.??????#?##?. 2,10
#????????.?..#.#.? 2,5,1,1,1,1
.?#???##.???#????##. 7,1,1,2
???????#???.##???# 2,1,1,6
?#???#???.?.?? 2,4,1,1
?.?.?.???.???.???? 1,1,2,1,2,1
?#??????.?#????#???. 4,1,1,1,1,1
??#?.##???? 1,1,5
?????#???# 3,1,1
.????.????#.. 3,1,2
???????#?.??##.???.? 5,2,1
?????????#?. 8,2
????#?#?.?.??##????? 1,5,1,1,4,1
?#.?#????####??#.? 2,12,1
?.?##..????#? 3,5
???#???#??? 1,6
??###???#????#.????? 1,7,1,1,2,1
??.????.?? 1,1,1
????.?##?#?## 2,7
.??????#???. 2,5
???##????#?#..## 1,2,4,2
.????.?##?? 1,1,4
#.??#?#.????.?.. 1,5,3,1
#.??.?#?.?#??. 1,1,1,3
???#??????#.?#?? 6,1,1,2
??.?.?#?.?? 1,3
?#???????#.? 4,1,1
?..????##????????.? 1,5,1,1,3,1
#..?#.?#??#??#??##?? 1,2,2,9
#??#?##??..??. 1,5,1,2
?#?????#????#??#..?? 2,12,1
??#.???#??????? 3,2,3,1,1
.?????.#????#???? 3,9
???.????#??????.?# 1,2,1,4,1
??.???.?#?# 1,3,4
#????????#??#..?#.? 4,8,2
????#?#?#??????????? 9,6
#???????#???#???.?.? 1,1,1,9,1,1
?????#?#?#??????. 1,9,2
?#????..?#????# 1,1,1,7
#?????????### 5,1,3
.#?????????? 1,3,1,1
?.?##???????#??#..?# 7,1,4,1
?#???????##??##?? 3,11
.????.#??.?#?#?#?.#? 2,1,1,1,7,1
???????#?.. 2,2
??#?#.?###??##??#?? 1,1,1,8,1,1
??##.?????????#?? 1,2,10
.?????.?#?. 1,1,2
#?????#??#???#..# 1,1,6,3,1
?#????#???.?.#?. 1,1,4,1,2
??#???##??.????#? 8,5
.????.?????#??. 4,1,4
????.??###?. 3,6
????.#???.? 1,4,1
??#???#????###?.. 3,8
.?#???????###??.## 13,2
????.#.????#??? 1,1,1,1,2
#??#?????.? 4,1,1
#?#.???????.? 3,3,1,1
.????????.??. 3,2,1
??.?.??.??##?????? 1,1,1,9
?..?#??#?#??#.?? 1,7,1
??.???##??#?.?? 2,5
.????#.??????? 3,1,2,3
??..??????#? 1,1,2,2
??#??.????# 1,3
??.???????? 1,6
??.?.?????????.???. 1,6,3
#???###???.#??? 1,6,2
?.#???#??????# 2,4,1
??##.???#??.????##. 2,5,6
##.?.????????# 2,1,3,1
#?##.??.#???? 4,4
????#????..?#?? 5,3
.??##?#???.?.???? 9,1,1
???#?#?#?.?.?.. 8,1,1
#????##???#???#???.# 4,2,7,1
.?.???#.?##?????# 1,1,2,3
#?????????#???..#. 5,8,1
???#??????#?..??? 5,3,2
???#?????? 4,1,1
?.???#????####????#? 1,3,6,1
????#?.#???.??#??? 1,1,2,1,5
##????#?..???? 7,2
?#??.?.??#?..???#? 4,1,1,2,5
.##????????..?? 6,1,1,1
????????.#????. 1,1,1,1,2
??????????#??.?????? 3,4,2,1,1,1
?#?.??????.? 1,2,2
.?.?#????#???? 2,1
?.?#????.?? 1,6,1
.?##???.?????. 2,2,4
#.????##?? 1,7
??#???##?#?? 2,6
.?.?#????. 3,2
?#??#?#.?.?##???? 6,1,4,1
?????.?.???#??????? 1,1,1,5,3
.#???????.#? 5,1
????..??#???#?. 3,8
?#??#???.?#?##.?? 7,4
?#????#..#????????? 2,1,1,4,1,1
...?#??#?.#?? 3,2,2
###???#?.???? 4,2,3
???#??????..?##? 4,4,4
????.????#? 2,1
????##?#???.???? 7,1,1
?????????.?..??. 3,2,1,2
#?..#????? 1,1,2
##???#????#?.???.. 7,2,1,1
??#????????#?..?##?? 11,3
.?#?..#??##???.. 3,8
##?#????#.?#?.#???## 2,2,3,2,2,2
???#???????????.? 1,3,5,1,1
#.????????#? 1,1,1,3
??.?.??.?.?.??????? 1,2
???.#???????#??## 1,3,8
..?#??.??##?????. 2,5
????.?????????? 1,1,2,2
#????.??#? 5,2
?.#??#????#?????.?# 5,5,1
?.?#??#??? 4,1
????????.????.? 8,2
????.?#?????. 1,1,3,2
???#??.?#??# 5,5
????#.?#?.##??????. 1,1,3,5,2
.?#??.?#?#?????. 4,4,2
??..?#?#????.#? 6,1
.?.#.?#????#???#?##? 1,1,15
#.?????##.? 1,5,1
.##?????.????????? 5,2,4
???.???.##???#.?#?? 1,1,1,6,4
???#??#?????# 1,2,4,1
#???.##??##????? 4,9
???...#?...???# 1,2,3
##?#?#????.# 6,1,1
.??#??..????.?# 2,1,1,1,1
##??#???????#.??# 5,1,1,1,2
.#???#?????##.??#?. 1,3,1,1,2,3
??????#???? 2,3
?.???#??#? 1,2,2
?#??.##?????#? 2,2,1,2
??#.??#?.??.#?#??? 3,3,1,1,1,1
?.?##?.?.???#?#.? 1,3,1,4
??.???#?###?#.? 1,1,6,1,1
.?.#?????#?.?????? 1,3,3,2,1
?#?#?####..#.? 8,1
???##?#????.??#??#?? 9,1,3,3
??#????#?.??#?. 1,7,4
???#..?.?? 1,1,1
?????#????.??###? 6,1,6
.#?????#?????.??# 1,5,1,1,2
???#????..???#### 3,7
???????##..? 1,4
.??.??.???... 1,2,3
.??.#?#?????#? 1,9
???#???.?????? 1,4,2,1
??.?#.?.??.?#???#?? 2,1,1,8
##.##?????????#.?? 2,2,7
???###??##?..??.??? 5,3,1,2
#..????#?#???? 1,1,4,2
???????????#? 2,2
??.?##?#????????#??# 1,8,2,1
????#?#???????????? 7,1,1,2,1
.#??.?#??.# 1,2,1
?#???????? 2,1,2
?????#??#???.??? 1,4,1,2
?.?????.?.????##? 3,7
???..#???#???#??. 1,2,7
???.#??#?#???#.?? 1,1,8,2
###?##?.???#??# 7,5
.???.?.??#? 1,1,2
??#??.???# 2,4
??###?????. 6,1
???#?#????.?.?#.?.# 4,5,2,1,1
.??????.?#...?#??. 2,1,3
.??#.??#?? 1,2
??#??.?#??#? 1,1,1,4
.?#?#?..#?.??? 5,1,2
#??#?##?#?..?#??? 1,7,1
#???????## 2,3,2
???.????##??#?#?.#?? 1,11,1
#.?..????#?#??..?#? 1,1,9,1
.?.?????#??? 1,4,1,1
.???.???..#?##??? 3,1,5
??..????.???.?# 1,4,1,2
???????#?? 1,1,3
.????????#??#.??. 1,9,1
?.?.#????.#????????. 3,7
????#??#??????.??.#? 8,3,2,1
?????.#???..???#??? 2,1,4,4,1
??#????..?.? 5,1
???#?#?#????.?##???? 11,7
?????????????#??? 4,10
?.??#...?#???.?.. 1,3
.????...???#...? 1,2
??#?.#.?????##? 3,1,1,1,2
????#.??#?.#. 1,1,3,1
#.??????#??##??#???? 1,17
###????.#?? 5,2
??????????#.?.?...?. 10,1,1
#.#.#.???##??#??.# 1,1,1,9,1
.??.??.#?. 1,1,1
?#???.???##??#?#? 1,1,1,8
.??##?#??????#???## 9,3,3
.???????#? 5,3
.????###??#?.???? 9,2
#?##??????????? 7,3,1
???..#?#???#???.? 1,9
??#.???#.# 2,1,1
#.?#??.#?.?? 1,3,1,2
.#??????#???????. 2,4,1,2
..??????.??? 1,2
?##???.??.??#???. 2,2,1,3,1
.?.?##???#.?? 3,2,1
..???????? 3,1
??.??#????????#?#? 1,1,1,1,5
#?.?#.###??##??????? 2,1,9,1
.#?????.??. 2,1,1
.??.??#????## 2,4,2
?#?#?#?#?###?..?? 12,1
??#??.??#???? 3,2
#??#??????.?????? 1,1,4,1,1
#??#???#??.????#??? 4,2,5,1
???????.?#?? 5,1
?.#??#??#????#???.? 8,6,1
.?##?#?.?.?? 5,1
??###??????##??. 5,4
?#?#.???.??# 1,1,2,2
.???????.?#?... 3,3
??.?#?????.?.??##?#? 1,1,3,1,7
?#.???????.???#? 2,1,1,1,2
.??#?????. 4,1
????.?#???.??????.. 2,3,1,5
.??????.#? 1,2
.??.???#?.? 2,3,1
#?##?.?.???.## 5,1,1,2
.##????.?? 4,1
#??.?#???.?##?... 1,1,4,3
?...##??.? 1,2,1
?###..#??? 3,1,1
?#?##?#??##??? 1,8,1
.??###??.?#?.???###? 4,3,5
?.??????#?##???? 1,1,9,1
?????#??.?????? 7,2
.???#????#???#? 6,2,3
????.????.?#?..??? 3,4,3,2
????.#?.???#?? 1,1,2,6
?.#???#?#?.?#?? 1,5,2,1,1
?#?.#.???????.?? 1,1,1,3,1
?#?????????????? 3,1,2,1,3
???.#??#?#???# 7,1
??#????#???.##??#. 8,1,5
???#?????#??.? 2,5
.#????.???? 5,1
??????#?????###?? 5,3
?..??#???.????? 1,1,1,2,1
#??.?...?.??. 2,1,2
?#???#?????.#??? 2,1,1,2,1
?#?????????.??????? 2,3,1,3,2
.?#???????? 2,2,1
?#??.?.?.?.? 3,1
?##?..????#?? 4,1,4
???#?..???????# 1,2,7
??#??##?.??????.?? 2,2,1,1,1,1
.#?#...#?????? 3,1
.??..??##? 1,4
?????##??.??##?.. 6,5
#?..?#???.?? 1,3,1
?##??.?.#?#????? 3,1,3,1,2
.?#?????..#?#..?? 7,3,1
????????##?##.?#.#?? 1,1,1,7,1,2
???..????.?.???##?? 2,2,1,1,2,1
??????.??????.# 3,1,2,1
#.??#????.??#?? 1,3,1,1,1
??#####??#?????#?# 10,3
##???###?#????? 12,1
????????????? 2,5
??#??.????.?##? 2,4,2
?.?#???.#?#.???#.. 1,4,3,2
????#????#? 2,2,2
???.#?.?#????? 1,1,2,6
?.#???#?????#?????. 5,5
??????#??#??? 1,7
??.??????#???#?????# 1,1,7,3,1
#?..?????? 1,3
??#???..???.# 3,2,2,1
?###?????? 6,1
???##.#??#?? 1,3,1,3
???##??..?#?#??? 3,4
??????##??.?????#? 9,1,5
?#???#?.?#???? 5,5
??.?.???.?? 1,2
??##??#?????# 2,7
???????.???????##?#. 1,1,1,1,7
#?#????#???.##.? 8,1,2,1
???#.??###??..#?#?? 1,1,4,1,1,3
.?.??###???#?.?????? 7,1
?#?#?#???????.?#? 5,2,3,2
???##???.??????#? 1,3,1,1,5
???????#?#??.? 1,2,5
????#?.??? 2,1,1";
            var sample = @"???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1";
            part1(sample);
            part2(sample);
            part1(input);
            part2(input);

        }
        private static void part2(string input)
        {
            long count = 0;
            var inputs = input.Split(new char[] { '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries).ToArray();
            int m = inputs.Length, n = inputs[0].Length;
            for (int i = 0; i < m; i++)
            {
                count += possibilities2(inputs[i]);
            }
            Console.WriteLine($"2nd star answer is {count}");
        }
        private static long possibilities2(string line)
        {
            long count = 0;
            var l = line.Split(new char[] { ' ', ',' });
            var ca = (l[0] +"?"+ l[0] + "?" + l[0] + "?" + l[0] + "?" + l[0] + ".").ToCharArray(); // last valid spring to have a border and do not handle edge cases
            var temp = l.Skip(1).Select(int.Parse).ToArray();
            var brokens = new List<int>(temp);
            brokens.AddRange(temp);
            brokens.AddRange(temp);
            brokens.AddRange(temp);
            brokens.AddRange(temp);
            var totalbrokens = brokens.Sum();
            int n = ca.Length, m = brokens.Count();
            var dp = new long[n + 1, m + 1];
            dp[0, 0] = 1;
            for (int i = 0; i < n; i++)
            {
                for (int spring = 0; spring <= m; spring++)
                {
                    if (dp[i, spring] == 0) continue;
                    if (ca[i] == '#' || ca[i] == '?') // start damaged
                    {
                        if (spring < m && i + brokens[spring] < n) // sinon pas possible de poser le bloc de fontaine
                        {
                            var canPose = true;
                            for (int j = 0; j < brokens[spring]; j++)
                            {
                                if (ca[i + j] == '.')
                                {
                                    canPose = false;
                                    break;
                                }
                            }
                            if (canPose && i + brokens[spring] < n-1 && ca[i+ brokens[spring]] == '#')
                            {
                                canPose = false; // because we have a # after the fountain 
                            }
                            if (canPose)
                            {
                                dp[i + brokens[spring] + 1, spring + 1] += dp[i, spring];
                            }
                        }
                    }
                    if (ca[i] == '.' || ca[i] == '?')
                    {
                        dp[i + 1, spring] += dp[i, spring];
                    }
                }
            }

            return dp[n, m];
        }

        private static void part1(string input)
        {
            int count = 0;
            var inputs = input.Split(new char[] { '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries).ToArray();
            int m = inputs.Length, n = inputs[0].Length;
            for (int i = 0; i < m; i++)
            {
                count += possibilities(inputs[i]);
            }
            Console.WriteLine($"1st star answer is {count}");
        }

        private static int possibilities(string line)
        {
            int count = 0;
            var l = line.Split(new char[] { ' ', ',' });
            var ca = l[0].ToCharArray();
            var brokens = l.Skip(1).Select(int.Parse).ToArray();
            var totalbrokens = brokens.Sum();
            var unknown = l[0].Count(c => c == '?');
            var known = l[0].Count(c => c == '#');
            dfs(0, known, unknown);
            return count;

            void dfs(int index, int damaged, int notknown)
            {
                if (index == ca.Length || notknown == 0)
                {
                    if (isValid())
                        count++;
                    return;
                }
                if (ca[index] != '?')
                    dfs(index + 1, damaged, notknown);
                else
                {
                    if (damaged + notknown > totalbrokens) // so we still have some ok fountain 
                    {
                        ca[index] = '.';
                        dfs(index + 1, damaged, notknown - 1);
                    }
                    if (damaged < totalbrokens)
                    {
                        ca[index] = '#';
                        dfs(index + 1, damaged + 1, notknown - 1);
                    }
                    ca[index] = '?';
                }
            }

            bool isValid()
            {
                int start = 0;
                while (start < ca.Length && ca[start] == '.') start++;
                var agr = new List<int>();
                for (int end = start; end < ca.Length; end++)
                {
                    if (ca[end] == '#') continue;
                    // current is '.'
                    agr.Add(end - start);
                    start = end;
                    while (start < ca.Length && ca[start] == '.') start++;
                    end = start;
                }
                if (ca[^1] == '#')
                {
                    agr.Add(ca.Length - start);
                }
                return agr.SequenceEqual(brokens);
            }

        }

    }

}