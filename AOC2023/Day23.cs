using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.ComponentModel.Design;
using System.Linq;
using System.Reflection.Metadata;
using System.Runtime.CompilerServices;
using System.Text;

namespace AOC2023
{
    public class Day23
    {

        public static void Main()
        {
            var input = @"#.###########################################################################################################################################
#.###.......#...#...#.....###...#...............###...#####...#...#...#...#...#.....#...#.........#.........#...........#...###...#.........#
#.###.#####.#.#.#.#.#.###.###.#.#.#############.###.#.#####.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#######.#.#######.#.#########.#.#.###.#.#.#######.#
#...#.....#...#.#.#.#...#...#.#.#.......#.......#...#...###.#.#.#.#.#.#.#.#.#...#...#.#.#.......#.#.#.......#.........#.#.#.###.#.#.#.......#
###.#####.#####.#.#.###.###.#.#.#######.#.#######.#####.###.#.#.#.#.#.#.#.#.#####.###.#.#######.#.#.#.###############.#.#.#.###.#.#.#.#######
#...#.....#...#...#...#...#.#.#.#...###.#.....###.#.....#...#.#.#.#.#.#.#.#.#.....###.#.#.......#.#.#.....###.........#.#.#.....#.#.#.#...###
#.###.#####.#.#######.###.#.#.#.#.#.###.#####.###.#.#####.###.#.#.#.#.#.#.#.#.#######.#.#.#######.#.#####.###.#########.#.#######.#.#.#.#.###
#...#.#.....#.........#...#...#...#.>.>.#.....#...#.#...#.#...#.#...#.#.#.#.#.....#...#.#.......#.#.#.....#...#.....#...#.......#...#...#...#
###.#.#.###############.#############v###.#####.###.#.#.#.#.###.#####.#.#.#.#####.#.###.#######.#.#.#.#####.###.###.#.#########.###########.#
###...#...........#...#...........###...#...###...#.#.#.#.#.###.#.....#.#...#.....#...#.#...###.#.#.#.#...#.....#...#.#...#...#.#...........#
#################.#.#.###########.#####.###.#####.#.#.#.#.#.###.#.#####.#####.#######.#.#.#.###.#.#.#.#.#.#######.###.#.#.#.#.#.#.###########
#.................#.#.#...#.......#.....###.#...#.#...#...#.>.>.#.....#.#...#.#...#...#.#.#.#...#.#.#.#.#.#...###...#.#.#.#.#.#.#.......#####
#.#################.#.#.#.#.#######.#######.#.#.#.###########v#######.#.#.#.#.#.#.#.###.#.#.#.###.#.#.#.#.#.#.#####.#.#.#.#.#.#.#######.#####
#.................#.#.#.#.#.......#.#...###...#.#...#.........###.....#.#.#...#.#.#...#.#.#.#...#.#.#.#.#.#.#.#.>.>.#...#.#.#.#.#.....#.....#
#################.#.#.#.#.#######.#.#.#.#######.###.#.###########.#####.#.#####.#.###.#.#.#.###.#.#.#.#.#.#.#.#.#v#######.#.#.#.#.###.#####.#
#.................#.#.#.#.#...#...#...#.......#...#.#...........#...#...#...#...#.###.#.#.#.#...#.#.#.#.#...#...#.......#...#...#...#.#.....#
#.#################.#.#.#.#.#.#.#############.###.#.###########.###.#.#####.#.###.###.#.#.#.#.###.#.#.#.###############.###########.#.#.#####
#...#.......#...###.#.#.#.#.#...#.............###.#...#.......#...#.#.#.....#...#.#...#.#.#.#.###...#.#.#.....###.....#...#.....###.#...#####
###.#.#####.#.#v###.#.#.#.#.#####.###############.###.#.#####.###.#.#.#.#######.#.#.###.#.#.#.#######.#.#.###.###.###.###.#.###.###.#########
###...#...#...#.>.#.#.#.#.#.#...#.............###.....#.#...#.....#...#.#.>.>...#.#...#...#.#.....#...#.#...#...#...#.#...#...#.#...###...###
#######.#.#####v#.#.#.#.#.#.#.#.#############.#########.#.#.###########.#.#v#####.###.#####.#####.#.###.###.###.###.#.#.#####.#.#.#####.#.###
#.......#.......#...#.#.#...#.#.....#...#...#.....###...#.#...........#.#.#.....#...#.#...#.#...#.#.#...###...#.....#...#.....#...#.....#...#
#.###################.#.#####.#####.#.#.#.#.#####.###.###.###########.#.#.#####.###.#.#.#.#.#.#.#.#.#.#######.###########.#########.#######.#
#.#.....#...........#...#...#.....#.#.#.#.#.#...#...#.....#.........#.#...#.....###...#.#.#...#...#...###...#.......#...#...........#...#...#
#.#.###.#.#########.#####.#.#####.#.#.#.#.#.#.#.###.#######.#######.#.#####.###########.#.###############.#.#######.#.#.#############.#.#.###
#.#.#...#.#...#.....#.....#.......#...#...#...#.....#...###.......#.#.....#...###.......#...#...#...#...#.#.........#.#.#...#.....#...#...###
#.#.#.###.#.#.#.#####.###############################.#.#########.#.#####.###.###.#########.#.#.#.#.#.#.#.###########.#.#.#.#.###.#.#########
#...#.....#.#.#.....#.#...........................#...#...#...#...#.......###...#.......#...#.#.#.#.#.#.#.....#.....#.#...#.#.#...#.........#
###########.#.#####.#.#.#########################.#.#####.#.#.#.###############.#######.#.###.#.#.#.#.#.#####.#.###.#.#####.#.#.###########.#
#.......#...#.....#.#...#...........#...#...#.....#.....#...#.#.......#...#...#...#...#.#.###.#.#.#.#.#.#...#.#...#.#...#...#.#.#...#...#...#
#.#####.#.#######.#.#####.#########.#.#.#.#.#.#########.#####.#######.#.#.#.#.###.#.#.#.#.###.#.#.#.#.#.#.#.#v###.#.###.#.###.#.#.#.#v#.#.###
#.....#.#.......#...#...#.........#.#.#.#.#...###.......#...#.........#.#.#.#.....#.#...#...#.#.#.#...#.#.#.>.>...#.#...#.#...#.#.#.>.#...###
#####.#.#######.#####.#.#########.#.#.#.#.#######.#######.#.###########.#.#.#######.#######.#.#.#.#####.#.###v#####.#.###.#.###.#.###v#######
#...#.#.........#...#.#.#...#.....#.#.#.#...#...#.......#.#...#...#...#.#...#...###.....#...#.#.#.#.....#.#...#...#.#...#...#...#.#...###...#
#.#.#.###########.#.#.#.#.#.#.#####.#.#.###.#.#.#######.#.###.#.#.#.#.#.#####.#.#######.#.###.#.#.#.#####.#.###.#.#.###.#####.###.#.#####.#.#
#.#...#...#...###.#.#.#.#.#.#.....#...#.....#.#.#.....#...###...#.#.#.#.......#.#.....#.#.....#...#.......#.....#.#.#...#.....#...#...###.#.#
#.#####.#v#.#.###.#.#.#.#.#.#####.###########.#.#.###.###########.#.#.#########.#.###.#.#########################.#.#.###.#####.#####.###.#.#
#.#...#.#.>.#...#.#.#.#.#.#.#.....#...#...###.#.#...#.###...#...#...#.#...#...#.#...#.#.........#.......###...#...#.#...#.#...#.....#.....#.#
#.#.#.#.#v#####.#.#.#.#.#.#.#v#####.#.#.#.###.#.###.#.###.#.#.#.#####.#.#.#.#.#v###.#.#########.#.#####.###.#.#.###.###.#.#.#.#####.#######.#
#...#...#.....#...#.#.#.#.#.>.>.#...#.#.#...#.#...#.#.#...#.#.#.#.....#.#...#.>.>.#.#...#.......#.....#.#...#.#...#.#...#...#.......#.......#
#############.#####.#.#.#.###v#.#.###.#.###.#.###.#.#.#.###.#.#.#.#####.#######v#.#.###.#.###########.#.#.###.###.#.#.###############.#######
#.............#...#.#.#.#.###.#.#.#...#.#...#.#...#.#.#...#.#.#.#.#...#...#.....#...###.#.....#.......#.#...#.#...#.#.#.............#...#...#
#.#############.#.#.#.#.#.###.#.#.#.###.#.###.#.###.#.###.#.#.#.#v#.#.###.#.###########.#####.#.#######.###.#.#.###.#.#.###########.###.#.#.#
#...#...#...###.#.#...#.#.#...#...#.#...#.....#.#...#.#...#.#.#.>.>.#.....#...#...#...#.......#...#...#.#...#.#...#.#.#.#.....#...#.....#.#.#
###.#.#.#.#.###.#.#####.#.#.#######.#.#########.#.###.#.###.#.###v###########.#.#.#.#.###########.#.#.#.#.###.###.#.#.#.#.###.#.#.#######.#.#
###...#...#...#.#.###...#.#.#.....#...#.....#...#...#...###...###.....#.....#...#...#.....#...#...#.#.#...###.....#...#...###...#...#.....#.#
#############.#.#.###.###.#.#.###.#####.###.#.#####.#################.#.###.#############.#.#.#.###.#.#############################.#.#####.#
#.............#.#...#.....#.#.#...#...#...#.#.......###...#...#...#...#...#.#.............#.#...#...#.................#.............#.#.....#
#.#############.###.#######.#.#.###.#.###.#.###########.#.#.#.#.#.#.#####.#.#.#############.#####.###################.#.#############.#.#####
#...........#...###.....###...#...#.#.#...#...###...#...#.#.#...#...#.....#.#.............#.#...#.#...........#...#...#.....#...#.....#.....#
###########.#.#########.#########.#.#.#.#####.###.#.#.###.#.#########.#####.#############.#.#.#.#.#.#########.#.#.#.#######.#.#.#.#########.#
#...........#.#.........#...#...#...#...#.....#...#...#...#.........#.....#...............#...#...#.........#...#...#...###...#...#.........#
#.###########.#.#########.#.#.#.#########v#####.#######.###########.#####.#################################.#########.#.###########.#########
#...#.........#.........#.#.#.#.#.......>.>...#...#.....#.....#...#...#...#...................#...###.....#.#...#...#.#.#...#.....#.#.......#
###.#.#################.#.#.#.#.#.#######v###.###.#.#####v###.#.#.###.#.###.#################.#.#.###.###.#.#.#.#.#.#.#.#.#.#.###.#.#.#####.#
###...#...#...#...#...#.#.#...#.#.#.....#.###...#.#.#...>.>.#...#.....#...#.#.....#...........#.#.#...###...#.#.#.#.#.#.#.#.#...#.#...#.....#
#######.#.#.#.#.#.#.#.#.#.#####.#.#.###.#.#####.#.#.#.###v#.#############.#.#.###.#.###########.#.#.#########.#.#.#.#.#.#.#.###.#.#####.#####
#...#...#...#...#...#...#.....#...#...#.#.#.....#.#.#.#...#.#.....#.....#...#...#.#.....#...###.#.#.........#.#.#.#.#.#.#.#.#...#...#...#...#
#.#.#.#######################.#######.#.#.#.#####.#.#.#.###.#.###.#.###.#######.#.#####.#.#.###.#.#########.#.#.#.#.#.#.#.#.#.#####.#.###.#.#
#.#...#...............###...#...#.....#.#.#.#...#.#.#.#...#.#.#...#.#...#...#...#.......#.#.#...#.###.......#.#.#.#.#.#.#.#.#.....#.#...#.#.#
#.#####.#############.###.#.###.#.#####.#.#.#.#.#.#.#.###.#.#.#.###.#.###.#.#.###########.#.#.###.###v#######.#.#.#.#.#.#.#.#####.#.###v#.#.#
#.#...#.#.............#...#.....#.....#...#.#.#.#.#...#...#...#.....#...#.#.#.......#...#.#.#...#.#.>.>...#...#.#.#.#.#.#.#...#...#...>.#.#.#
#.#.#.#.#.#############.#############.#####.#.#.#.#####.###############.#.#.#######.#.#.#.#.###.#.#.#v###.#.###.#.#.#.#.#.###.#.#######v#.#.#
#...#...#...........###.......#...#...#...#...#.#.#.....#...###.........#.#.###...#.#.#.#.#.#...#...#...#.#.###...#.#.#...###...###...#...#.#
###################v#########.#.#.#.###.#.#####.#.#.#####.#.###.#########.#.###.#.#v#.#.#.#.#.#########.#.#.#######.#.#############.#.#####.#
#.................#.>.#...#...#.#.#.....#...###...#.....#.#...#.........#.#.....#.>.>.#.#.#.#.......###.#...#...#...#...#...#...#...#.#...#.#
#.###############.#v#.#.#.#.###.#.#########.###########.#.###.#########.#.#########v###.#.#.#######.###.#####.#.#.#####.#.#.#.#.#.###.#.#.#.#
#.......#.......#...#...#.#.#...#.....#.....#...#.......#...#...#.....#.#.#.........#...#.#.#.....#.#...#...#.#.#...#...#.#.#.#.#...#.#.#...#
#######.#.#####.#########.#.#.#######.#.#####.#.#.#########.###.#.###.#.#.#.#########.###.#.#.###.#.#.###.#.#.#.###.#.###.#.#.#.###.#.#.#####
#.......#.#.....#.......#.#.#...#...#...#####.#.#...........###...#...#.#.#...#.....#...#.#.#...#...#...#.#.#.#...#.#.#...#...#.....#.#.....#
#.#######.#.#####.#####.#.#.###.#.#.#########.#.###################.###.#.###.#.###.###.#.#.###.#######.#.#.#.###.#.#.#.#############.#####.#
#...#.....#.......#.....#.#.#...#.#...........#.....#...............###...###...###...#.#.#.....#...###...#...#...#...#.#...#.......#.#...#.#
###.#.#############.#####.#.#.###.#################.#.###############################.#.#.#######.#.###########.#######.#.#.#.#####.#.#.#.#.#
#...#.#.............#...#...#...#.#...#.....#.......#.......................###.......#.#.#.....#.#.#####.......#...###...#.#.#.....#...#.#.#
#.###.#.#############.#.#######.#.#.#.#.###.#.#############################.###.#######.#.#.###.#.#.#####.#######.#.#######.#.#.#########.#.#
#.....#...............#...#...#...#.#...###...#...#...#...#.................#...#...###...#.#...#.#.#.....#...###.#.###...#...#.........#.#.#
#########################.#.#.#####.###########.#.#.#.#.#.#.#################.###.#.#######.#.###.#.#.#####.#.###.#.###.#.#############.#.#.#
###...###...#.............#.#.#...#.......#...#.#.#.#...#.#.................#...#.#...###...#...#.#.#.....#.#.#...#.....#.#.............#.#.#
###.#.###.#.#.#############.#.#.#.#######.#.#.#.#.#.#####.#################.###.#.###.###.#####.#.#.#####.#.#.#.#########.#.#############.#.#
#...#.....#...#.......#...#.#...#.........#.#.#.#.#.....#.#...###...........###...###...#.....#.#.#.#...#...#...#.........#.............#.#.#
#.#############.#####.#.#.#.###############.#.#.#.#####.#.#.#.###v#####################.#####.#.#.#.#.#.#########v#####################.#.#.#
#.........#...#.#.....#.#.#.#...#.........#.#.#.#...#...#.#.#...>.>.###...###...#...###.#...#.#.#.#.#.#...#...#.>.>.......#.............#...#
#########.#.#.#.#.#####.#.#.#.#.#.#######.#.#.#.###.#.###.#.#####v#.###.#.###.#.#.#.###v#.#.#.#.#.#.#.###.#.#.#.#v#######.#.#################
#...#...#...#...#...###.#.#...#.#.#.......#.#.#.###...###...#...#.#.#...#...#.#.#.#.#.>.>.#...#.#.#.#...#.#.#...#.#.......#.........###.....#
#.#.#.#.###########v###.#.#####.#.#.#######.#.#.#############.#.#.#.#.#####.#.#.#.#.#.#v#######.#.#.###.#.#.#####.#.###############.###.###.#
#.#.#.#...###...###.>...#...###...#.#...#...#.#...#...#...#...#.#.#.#.....#...#...#...#.....#...#.#.#...#...#...#.#.#...###...#...#...#.#...#
#.#.#.###.###.#.###v#######.#######.#.#.#.###.###.#.#.#.#.#.###.#.#.#####.#################.#.###.#.#.#######.#.#.#.#.#.###.#.#.#.###.#.#.###
#.#.#...#.#...#.#...#.......#...###.#.#.#.#...#...#.#...#...#...#.#.#...#.#...........#...#.#.....#.#.#.......#.#.#.#.#...#.#.#.#.....#.#.###
#.#.###.#.#.###.#.###.#######.#.###v#.#.#.#.###.###.#########.###.#.#.#.#.#.#########.#.#.#.#######.#.#.#######.#.#.#.###.#.#.#v#######.#.###
#.#.#...#.#...#.#...#...#.....#...>.>.#.#.#.....###.........#...#.#...#...#.........#...#.#.......#.#.#.#.....#...#...###.#.#.>.#.......#...#
#.#.#.###.###.#.###.###.#.#########v###.#.#################.###.#.#################.#####.#######.#.#.#.#.###.###########.#.###v#.#########.#
#.#.#...#.#...#.....###.#.#.......#...#.#.....#...........#...#.#...#.........#...#.....#.#.......#...#...###...#...#...#.#.###...#.........#
#.#.###.#.#.###########.#.#.#####.###.#.#####.#.#########.###.#.###.#.#######.#.#.#####.#.#.###################.#.#.#.#.#.#.#######.#########
#.#.....#.#...........#...#...###.....#...#...#.........#.#...#.....#.......#...#...#...#.#.......#...#.....###...#...#.#.#.#.......###.....#
#.#######.###########.#######.###########.#.###########.#.#.###############.#######.#.###.#######.#.#.#.###.###########.#.#.#.#########.###.#
#...#...#...#.........#.......#...###...#.#.#...#.......#...#...###.....###.......#.#...#.#...#...#.#...#...#.......#...#.#.#.....#...#.#...#
###.#.#.###.#.#########.#######.#.###.#.#.#.#.#.#.###########.#.###.###.#########.#.###.#.#.#.#.###.#####.###.#####.#.###.#.#####.#.#.#.#.###
###...#...#...#...#...#.........#.#...#.#...#.#.#.............#...#...#.#.........#.....#...#...###.....#.....#...#.#...#...#...#...#...#...#
#########v#####.#.#.#.###########.#.###.#####.#.#################.###.#.#.#############################.#######.#.#.###.#####.#.###########.#
#.......#.>.#...#.#.#.#...........#...#.#...#.#.#...#.............#...#.#...........#.....#.....###...#.........#.#...#.#.....#...#...#.....#
#.#####.#v#.#.###.#.#.#.#############.#.#.#.#.#.#.#.#.#############.###.###########.#.###.#.###.###.#.###########.###.#.#.#######.#.#.#.#####
#.....#...#.#.#...#.#.#.........#...#.#.#.#.#.#.#.#.#.........#...#.#...#####.......#...#.#.#...#...#.#.........#...#...#.....###...#.#.....#
#####.#####.#.#.###.#.#########.#.#.#.#.#.#.#.#.#.#.#########.#.#.#.#.#######.#########.#.#.#.###.###.#.#######.###.#########.#######.#####.#
#.....#...#...#...#.#.###.......#.#.#.#.#.#.#.#.#.#.#.........#.#.#.#...#.....#...#...#.#.#.#.###...#.#.......#...#...###...#.......#.#...#.#
#.#####.#.#######.#.#.###.#######.#.#.#.#.#.#.#.#.#.#v#########.#.#.###.#.#####.#.#.#.#.#.#.#.#####.#.#######.###.###.###.#.#######.#.#.#.#.#
#.......#.#.....#...#...#.....###.#.#.#.#.#.#.#.#.#.>.>.....#...#.#...#.#.......#.#.#.#.#.#.#...#...#.#...#...###.....#...#.#.......#...#.#.#
#########.#.###.#######.#####.###.#.#.#.#.#.#.#.#.###v#####.#.###.###.#.#########.#.#.#.#.#.###.#.###.#.#.#.###########.###.#.###########.#.#
#...#...#.#...#.........###...#...#.#.#.#.#.#.#...###...#...#...#.###.#.#...#.....#.#.#.#.#.#...#...#.#.#.#.###...#...#...#.#.....#...###...#
#.#.#.#.#.###.#############.###.###.#.#.#.#.#.#########.#.#####.#.###.#.#.#.#v#####.#.#.#.#.#.#####.#.#.#.#v###.#.#.#.###.#.#####.#.#.#######
#.#...#.#...#.#...#...#...#...#...#.#.#...#.#.#.........#.....#.#...#.#.#.#.>.>.#...#.#.#.#.#.#...#.#.#.#.>.>.#.#.#.#.###.#.#.....#.#.......#
#.#####.###.#.#.#.#.#.#.#.###v###.#.#.#####.#.#.#############.#.###.#.#.#.###v#.#.###.#.#.#.#.#.#.#.#.#.###v#.#.#.#.#.###.#.#v#####.#######.#
#.....#.....#...#.#.#.#.#.#.>.>...#.#...###...#.............#.#.###.#.#...#...#.#.###.#.#.#.#.#.#...#...#...#.#.#.#.#.#...#.>.###...#.......#
#####.###########.#.#.#.#.#.#v#####.###.###################.#.#.###.#.#####.###.#.###.#.#.#.#.#.#########.###.#.#.#.#.#.#####v###.###.#######
#...#.....#.....#.#.#.#.#...#.....#.....#...#...............#...###...#...#.###...#...#.#...#...###...#...###.#.#.#.#.#.#.....###.#...###...#
#.#.#####.#.###.#.#.#.#.#########.#######.#.#.#########################.#.#.#######.###.###########.#.#.#####.#.#.#.#.#.#.#######.#.#####.#.#
#.#.......#.#...#.#.#.#.#.........#.......#.#...........###...#.........#.#.......#.#...#...........#...#...#.#.#.#.#...#...#...#.#.#...#.#.#
#.#########.#.###.#.#.#.#.#########.#######.###########.###.#.#.#########.#######.#.#.###.###############.#.#.#.#.#.#######.#.#.#.#.#.#.#.#.#
#...........#.###...#...#...........#...#...###.......#.....#.#.........#.........#...###.................#.#.#.#.#...#...#...#...#...#...#.#
#############.#######################.#.#.#####.#####.#######.#########.###################################.#.#.#.###.#.#.#################.#
#.......#...#...#...................#.#...#...#.....#.....#...#.....#...#.......#.....#...#.................#.#.#.....#.#.......#...#.....#.#
#.#####.#.#.###.#.#################.#.#####.#.#####.#####.#.###.###.#.###.#####.#.###.#.#.#.#################.#.#######.#######.#.#.#.###.#.#
#.....#...#.....#.....#.....#.....#.#...###.#.#####.....#...###...#.#.....#.....#.#...#.#.#.....#.........###...###...#...#...#.#.#...###...#
#####.###############.#.###.#.###.#.###.###.#.#########.#########.#.#######.#####.#.###.#.#####.#.#######.#########.#.###.#.#.#.#.###########
#.....#.............#.#.#...#.#...#.....#...#...#...###.......#...#.###...#.......#.....#.....#...###.....#.....#...#.###...#.#.#...........#
#.#####.###########.#.#.#.###.#.#########.#####.#.#.#########.#.###.###.#.###################.#######.#####.###.#.###.#######.#.###########.#
#...#...#...........#...#.....#.......#...#.....#.#...........#...#...#.#.......#.............#.....#.....#.#...#.#...#...#...#.............#
###.#.###.###########################.#.###.#####.###############.###.#.#######.#.#############.###.#####.#.#.###.#.###.#.#.#################
#...#.#...#.......#...###.............#...#...#...#.........#...#.#...#.......#.#.....###.....#...#.......#.#.....#.###.#.#...#.........#...#
#.###.#.###.#####.#.#.###.###############.###.#.###.#######.#.#.#.#.#########.#.#####.###.###.###.#########.#######.###.#.###.#.#######.#.#.#
#.....#...#.#.....#.#...#.......###...###...#.#.....###.....#.#.#.#.#...###...#.......#...#...###.........#.#.....#...#.#...#...#.....#...#.#
#########.#.#.#####.###.#######.###.#.#####.#.#########v#####.#.#.#.#.#.###v###########.###.#############.#.#.###.###.#.###.#####.###.#####.#
#.........#.#...###...#.#...#...#...#...#...#.#...#...>.>.#...#.#.#.#.#.#.>.>.#...#...#.#...#...###.......#.#...#.....#.#...#.....###.......#
#.#########.###.#####.#.#.#.#.###.#####.#.###.#.#.#.#####.#.###.#.#.#.#.#.###.#.#.#.#.#.#.###.#.###.#######.###.#######.#.###.###############
#.#...#...#.###...###.#.#.#.#...#.....#.#...#.#.#.#...###.#...#.#.#.#.#.#.###...#.#.#.#.#...#.#...#.....###...#.#.....#.#...#.........###...#
#.#.#.#.#.#.#####.###.#.#.#.###v#####.#.###.#.#.#.###.###.###.#.#.#.#.#.#.#######.#.#.#.###.#.###.#####.#####.#.#.###.#.###.#########.###.#.#
#.#.#.#.#.#...###...#.#.#.#.#.>.>...#.#...#.#.#.#.#...#...#...#.#.#...#.#.#...#...#.#.#.#...#.#...#...#.#...#.#.#.#...#.#...#...#...#.#...#.#
#.#.#.#.#.###.#####.#.#.#.#.#.#####.#.###.#.#.#.#.#.###.###.###.#.#####.#.#.#.#.###.#.#.#.###.#.###.#.#v#.#.#.#.#.#.###.#.###.#.#v#.#.#.###.#
#.#.#.#.#...#.#.....#.#.#.#.#.....#.#.#...#.#.#.#.#.###...#.###.#.#.....#.#.#...#...#.#.#...#.#...#.#.>.>.#.#.#.#.#...#.#.#...#.>.#...#...#.#
#.#.#.#.###.#.#.#####.#.#.#.#####.#.#.#.###.#.#.#.#.#####.#.###.#.#.#####.#.#####.###.#.###.#.###.#.#######.#.#.#.###.#.#.#.#####v#######.#.#
#...#...###...#.......#...#.......#...#.....#...#...#####...###...#.......#.......###...###...###...#######...#...###...#...#####.........#.#
###########################################################################################################################################.#";
            var sample = @"#.#####################
#.......#########...###
#######.#########.#.###
###.....#.>.>.###.#.###
###v#####.#v#.###.#.###
###.>...#.#.#.....#...#
###v###.#.#.#########.#
###...#.#.#.......#...#
#####.#.#.#######.#.###
#.....#.#.#.......#...#
#.#####.#.#.#########v#
#.#...#...#...###...>.#
#.#.#v#######v###.###v#
#...#.>.#...>.>.#.###.#
#####v#.#.###v#.#.###.#
#.....#...#...#.#.#...#
#.#########.###.#.#.###
#...###...#...#...#.###
###.###.#.###v#####v###
#...#...#.#.>.>.#.>.###
#.###.###.#.###.#.#v###
#.....###...###...#...#
#####################.#";
            part1(sample);
            part2(sample);
            part1(input);
            part2(input);
        }

        private static int[] dx = new int[] { -1, 0, 1, 0, -1 };
        private static void part1(string input)
        {
            var inputs = input.Split("\r\n", StringSplitOptions.RemoveEmptyEntries).ToArray();
            long count = 0;
            int m = inputs.Length, n = inputs[0].Length; ;
            var grid = new char[m][];
            for (int i = 0; i < m; i++)
            {
                grid[i] = inputs[i].ToCharArray();
            }
            int maxPath = 0;
            for (int c = 0; c < n; c++)
            {
                if (grid[0][c] == '.')
                {
                    grid[0][c] = 'O';
                    grid[1][c] = 'O';
                    dfs(1, c, 1);
                    grid[1][c] = 'O';
                    grid[0][c] = '.';
                }
            }
            Console.WriteLine($"1st star is {maxPath}");

            void dfs(int row, int col, int step)
            {
                if (row == m - 1)
                {
                    maxPath = Math.Max(maxPath, step);
                    return;
                }
                for (int i = 0; i < 4; i++)
                {
                    int dr = row + dx[i], dc = col + dx[i + 1];
                    if (grid[dr][dc] == '#' || grid[dr][dc] == 'O') continue;
                    if (grid[dr][dc] == '.')
                    {
                        grid[dr][dc] = 'O';
                        dfs(dr, dc, step + 1);
                        grid[dr][dc] = '.';
                        continue;
                    }
                    if (grid[dr][dc] == '^' && i == 0)
                    {
                        grid[dr][dc] = 'O';
                        dfs(dr, dc, step + 1);
                        grid[dr][dc] = '^';
                    }
                    if (grid[dr][dc] == '>' && i == 1)
                    {
                        grid[dr][dc] = 'O';
                        dfs(dr, dc, step + 1);
                        grid[dr][dc] = '>';
                    }
                    if (grid[dr][dc] == 'v' && i == 2)
                    {
                        grid[dr][dc] = 'O';
                        dfs(dr, dc, step + 1);
                        grid[dr][dc] = 'v';
                    }
                    if (grid[dr][dc] == '<' && i == 3)
                    {
                        grid[dr][dc] = 'O';
                        dfs(dr, dc, step + 1);
                        grid[dr][dc] = '<';
                    }
                }

            }
        }
        private static void part2(string input)
        {
            var inputs = input.Split("\r\n", StringSplitOptions.RemoveEmptyEntries).ToArray();
            long count = 0;
            int m = inputs.Length, n = inputs[0].Length; ;
            var grid = new char[m][];
            for (int i = 0; i < m; i++)
            {
                grid[i] = inputs[i].ToCharArray();
            }
            int maxPath = 0;
            for (int c = 0; c < n; c++)
            {
                if (grid[0][c] == '.')
                {
                    grid[0][c] = 'O';
                    grid[1][c] = 'O';
                    dfs(1, c, 1);
                    grid[1][c] = 'O';
                    grid[0][c] = '.';
                }
            }
            Console.WriteLine($"2ns star is {maxPath}");

            void dfs(int row, int col, int step)
            {
                if (row == m - 1)
                {
                    maxPath = Math.Max(maxPath, step);
                    return;
                }
                for (int i = 0; i < 4; i++)
                {
                    int dr = row + dx[i], dc = col + dx[i + 1];
                    if (grid[dr][dc] == '#' || grid[dr][dc] == 'O') continue;
                    grid[dr][dc] = 'O';
                    dfs(dr, dc, step + 1);
                    grid[dr][dc] = '.';
                    continue;
                }

            }
        }


    }
}